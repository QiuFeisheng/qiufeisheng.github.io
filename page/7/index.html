<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Stay hungry">
<meta property="og:type" content="website">
<meta property="og:title" content="QiuFeisheng&#39;Blog">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="QiuFeisheng&#39;Blog">
<meta property="og:description" content="Stay hungry">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="QiuFeisheng&#39;Blog">
<meta name="twitter:description" content="Stay hungry">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/7/">





  <title>QiuFeisheng'Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">QiuFeisheng'Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/06/基础Demo6-Activity的4S启动模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/06/基础Demo6-Activity的4S启动模式/" itemprop="url">基础Demo6-Activity的4S启动模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-06T00:00:00+08:00">
                2019-04-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、Standard"><a href="#1、Standard" class="headerlink" title="1、Standard"></a>1、Standard</h3><p>：默认的启动模式，一个Activity可以创建无限个实例</p>
<h3 id="2、SingleTop"><a href="#2、SingleTop" class="headerlink" title="2、SingleTop"></a>2、SingleTop</h3><p>：程序正处于当前Activity A时，即栈顶，用Intent再跳转到A，不会再创建A的实例，此时不能无限生成A,但是如果是ABC,跳转到A会再生成一个实例，最后是ABCA，此时这两个A是不一样的噢，特别是数据方面。</p>
<pre><code>&lt;activity
android:name=&quot;.Main2Activity&quot;
android:launchMode=&quot;singleTop&quot;&gt;
&lt;/activity&gt;
</code></pre><h3 id="3、SingleTask"><a href="#3、SingleTask" class="headerlink" title="3、SingleTask"></a>3、SingleTask</h3><p>： 简单粗暴，例如是ABC—-&gt;跳转到A，会直接将C,B finish掉，让A直接暴露在栈顶，此时就是运行状态onResume()</p>
<pre><code>&lt;activity
android:name=&quot;.Main2Activity&quot;
android:launchMode=&quot;singleTask&quot;&gt;
&lt;/activity&gt;
</code></pre><h3 id="4、SingleInstance"><a href="#4、SingleInstance" class="headerlink" title="4、SingleInstance"></a>4、SingleInstance</h3><p>: 独立的返回栈，对于要被其他程序共享调用的Activity，我们可以将该Activity的启动模式设置为SingleInstance， ABC—-C–A–B</p>
<pre><code>&lt;activity
android:name=&quot;.Main2Activity&quot;
android:launchMode=&quot;singleInstance&quot;&gt;
&lt;/activity&gt;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/05/基础Demo5-Activity意外回收保存数据/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/05/基础Demo5-Activity意外回收保存数据/" itemprop="url">基础Demo5-Activity意外回收保存数据</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-05T00:00:00+08:00">
                2019-04-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、应用场景：Activity-A跳转到Activity-B-然后当系统内存不足的情况下，可能会回收Activity-A-所以当B-finish之后，回来的Activity-A的数据可能是重新初始化的，可能造成数据丢失。"><a href="#1、应用场景：Activity-A跳转到Activity-B-然后当系统内存不足的情况下，可能会回收Activity-A-所以当B-finish之后，回来的Activity-A的数据可能是重新初始化的，可能造成数据丢失。" class="headerlink" title="1、应用场景：Activity A跳转到Activity B,然后当系统内存不足的情况下，可能会回收Activity A,所以当B finish之后，回来的Activity A的数据可能是重新初始化的，可能造成数据丢失。"></a>1、应用场景：Activity A跳转到Activity B,然后当系统内存不足的情况下，可能会回收Activity A,所以当B finish之后，回来的Activity A的数据可能是重新初始化的，可能造成数据丢失。</h3><h3 id="2、Demo代码"><a href="#2、Demo代码" class="headerlink" title="2、Demo代码"></a>2、Demo代码</h3><pre><code>public static final String SAVE_KEY=&quot;save_key&quot;;
private String data;
......

//1、重写onSaveInstanceState, data---&gt;key---&gt;outState： key是快递，outState是快递车

@Override
protected void onSaveInstanceState(Bundle outState) {
super.onSaveInstanceState(outState);

outState.putString(SAVE_KEY,data);
}


//2、在onCreate()里面的savedInstanceState取值后再填充显示即可
@Override
protected void onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.activity_main);

if (savedInstanceState!=null){
    String tempData=savedInstanceState.getString(SAVE_KEY);
    Log.d(&quot;保存的数据&quot;,tempData);
 }
initView();
initData();
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/04/基础Demo4-Intent返回数据给上一个Activity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/04/基础Demo4-Intent返回数据给上一个Activity/" itemprop="url">基础Demo4-Intent返回数据给上一个Activity</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-04T00:00:00+08:00">
                2019-04-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、思路"><a href="#1、思路" class="headerlink" title="1、思路"></a>1、思路</h3><p> <img src="https://i.imgur.com/XfmouoW.jpg" alt></p>
<h3 id="2、Demo代码"><a href="#2、Demo代码" class="headerlink" title="2、Demo代码"></a>2、Demo代码</h3><p>（1）MainActivity.java</p>
<pre><code>@Override
public void onClick(View view) {

switch (view.getId()) {

    case R.id.btn_1:

        //构造对象：Intent对象
        Intent intent=new Intent(MainActivity.this,Main2Activity.class);
        //调用+ForResult，1是请求码，下一个接收的Activity会标记，返回的时候会一起返回 
       //因为跳转到N个Activity，我们可以根据请求码requestCode来区分是哪一个Activity

       //返回的数据回来   
       startActivityForResult(intent,1);

        break;
        default:break;
    }
 }

  @Override
  protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {

//请求码区分是哪一个Activity返回的数据，其实都是自己设置的
switch (requestCode){

    case 1:
 //根据结果码来判断是否返回成功，再开始取数据
        if (resultCode==RESULT_OK){
            //data.getXXXExtra(key)；
            String data1=data.getStringExtra(Main2Activity.DATA_RETURN);
            mTextView.setText(data1);

        }
    }
}
</code></pre><p>（2）Main2Activity</p>
<pre><code>//finish前面携带在intent中即可，结果码一般都是RESULT_OK不用改
@Override
public void onClick(View view) {

data=&quot;I am spider man&quot;;
Intent intent=new Intent();
intent.putExtra(DATA_RETURN,data);
setResult(RESULT_OK,intent);
finish();
}

//重写返回键back键
@Override
public void onBackPressed() {
data=&quot;I am spider man&quot;;
Intent intent=new Intent();
intent.putExtra(DATA_RETURN,data);
setResult(RESULT_OK,intent);
finish();
}
</code></pre><p>//常量作为Key的好处是： 可以在多个类多处调用，而且取值的时候不会出现手写key错误的概率</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/基础Demo3-Intent传递数据/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/基础Demo3-Intent传递数据/" itemprop="url">基础Demo3-Intent传递数据</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T00:00:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、思路"><a href="#1、思路" class="headerlink" title="1、思路"></a>1、思路</h3><p>  <img src="https://i.imgur.com/HtXWRlH.jpg" alt></p>
<h3 id="2、Demo代码"><a href="#2、Demo代码" class="headerlink" title="2、Demo代码"></a>2、Demo代码</h3><p>（1）MainActivity.java</p>
<pre><code>......
public static final String DATA_KEY=&quot;data_key&quot;;
private String data;
......

@Override
public void onClick(View view) {

switch (view.getId()) {

    case R.id.btn_1:

        //一般写成全局变量field比较好
         data=&quot;I am iron man&quot;;

        //构造对象：Intent对象
        Intent intent=new Intent(MainActivity.this,Main2Activity.class);
        //将数据打包存储到key，再通过快递车intent一起发送到下一个Activity
        intent.putExtra(DATA_KEY,data);
        //开车
        startActivity(intent);

        break;
        default:break;
   }
}
</code></pre><p>(2)Main2Activity.java</p>
<pre><code>public class Main2Activity extends AppCompatActivity {

private TextView mTextView;
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main2);

    mTextView=(TextView)findViewById(R.id.tv_content);

    //构造Intent对象：去快递车
    Intent intent=getIntent();
    //从快递车的快递包裹DATA_KEY取值
    String data=intent.getStringExtra(MainActivity.DATA_KEY);
    //填充Data显示到view
    mTextView.setText(data);
   }
}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/02/基础Demo2-隐式Intent的使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/02/基础Demo2-隐式Intent的使用/" itemprop="url">基础Demo2-隐式Intent的使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-02T00:00:00+08:00">
                2019-04-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、思路"><a href="#1、思路" class="headerlink" title="1、思路"></a>1、思路</h3><p> <img src="https://i.imgur.com/gBw8NM9.jpg" alt></p>
<h3 id="2、Demo代码"><a href="#2、Demo代码" class="headerlink" title="2、Demo代码"></a>2、Demo代码</h3><p>(1)activity_main.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout
xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
android:layout_width=&quot;match_parent&quot;
android:layout_height=&quot;match_parent&quot;
android:orientation=&quot;vertical&quot;&gt;

&lt;Button
    android:id=&quot;@+id/btn_1&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text=&quot;打开系统浏览器&quot;/&gt;

&lt;Button
    android:id=&quot;@+id/btn_2&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:text=&quot;打开系统电话&quot;/&gt;

&lt;/LinearLayout&gt;
</code></pre><p>（2）MainActivity.java</p>
<pre><code>import android.content.Intent;
import android.net.Uri;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;

public class MainActivity extends AppCompatActivity implements View.OnClickListener {

private Button btn_1;
private Button btn_2;
@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_main);

    initView();
    initData();
}

private void initView() {

   btn_1= (Button) findViewById(R.id.btn_1);
   btn_2= (Button) findViewById(R.id.btn_2);
}

private void initData() {

    btn_1.setOnClickListener(this);
    btn_2.setOnClickListener(this);
}
@Override
public void onClick(View view) {

     switch (view.getId()){

         case R.id.btn_1:
             //1、传入隐式Intent的action值，构造Intent对象
             //action值一般是传入Android系统可以响应的action值
             //当然也可以在某个Activity的action值配置Intent-filter就可以响应此Intent
             Intent intent=new Intent(Intent.ACTION_VIEW);

             //调用象方：initData()，传入Uri对象
             intent.setData(Uri.parse(&quot;http://www.baidu.com&quot;));

             //开启可以响应此Intent的Activity(可能是系统应用的Activity)
             startActivity(intent);
             break;

         case R.id.btn_2:
             Intent intent2=new Intent(Intent.ACTION_DIAL);
             intent2.setData(Uri.parse(&quot;tel:15622391415&quot;));
             startActivity(intent2);
             break;
     }  }
}
</code></pre><h3 id="3、常用的action值"><a href="#3、常用的action值" class="headerlink" title="3、常用的action值"></a>3、常用的action值</h3><pre><code>// 调用浏览器 
Uri webViewUri = Uri.parse(&quot;http://blog.csdn.net/zuolongsnail&quot;); 
Intent intent = new Intent(Intent.ACTION_VIEW, webViewUri); 

// 调用地图 
Uri mapUri = Uri.parse(&quot;geo:100,100&quot;); 
Intent intent = new Intent(Intent.ACTION_VIEW, mapUri); 

// 播放mp3 
Uri playUri = Uri.parse(&quot;file:///sdcard/test.mp3&quot;); 
Intent intent = new Intent(Intent.ACTION_VIEW, playUri); 
intent.setDataAndType(playUri, &quot;audio/mp3&quot;); 


// 调用拨打电话 
Uri dialUri = Uri.parse(&quot;tel:10086&quot;); 
Intent intent = new Intent(Intent.ACTION_DIAL, dialUri); 

// 直接拨打电话，需要加上权限
&lt;uses-permission id=&quot;android.permission.CALL_PHONE&quot; /&gt; 
Uri callUri = Uri.parse(&quot;tel:10086&quot;); 
Intent intent = new Intent(Intent.ACTION_CALL, callUri); 

// 调用发邮件（这里要事先配置好的系统Email，否则是调不出发邮件界面的） 
Uri emailUri = Uri.parse(&quot;mailto:zuolongsnail@163.com&quot;); 
Intent intent = new Intent(Intent.ACTION_SENDTO, emailUri); 

// 直接发邮件 
Intent intent = new Intent(Intent.ACTION_SEND); 
String[] tos = { &quot;zuolongsnail@gmail.com&quot; }; 
String[] ccs = { &quot;zuolongsnail@163.com&quot; }; 
intent.putExtra(Intent.EXTRA_EMAIL, tos); 
intent.putExtra(Intent.EXTRA_CC, ccs); 
intent.putExtra(Intent.EXTRA_TEXT, &quot;the email text&quot;); 
intent.putExtra(Intent.EXTRA_SUBJECT, &quot;subject&quot;); 
intent.setType(&quot;text/plain&quot;); 
Intent.createChooser(intent, &quot;Choose Email Client&quot;); 

// 发短信 
Intent intent = new Intent(Intent.ACTION_VIEW); 
intent.putExtra(&quot;sms_body&quot;, &quot;the sms text&quot;); 
intent.setType(&quot;vnd.android-dir/mms-sms&quot;); 

// 直接发短信 
Uri smsToUri = Uri.parse(&quot;smsto:10086&quot;); 
Intent intent = new Intent(Intent.ACTION_SENDTO, smsToUri); 
intent.putExtra(&quot;sms_body&quot;, &quot;the sms text&quot;); 

// 发彩信 
Uri mmsUri = Uri.parse(&quot;content://media/external/images/media/23&quot;); 
Intent intent = new Intent(Intent.ACTION_SEND); 
intent.putExtra(&quot;sms_body&quot;, &quot;the sms text&quot;); 
intent.putExtra(Intent.EXTRA_STREAM, mmsUri); 
intent.setType(&quot;image/png&quot;); 

// 卸载应用 
Uri uninstallUri = Uri.fromParts(&quot;package&quot;, &quot;com.app.test&quot;, null); 
Intent intent = new Intent(Intent.ACTION_DELETE, uninstallUri); 

// 安装应用 
Intent intent = new Intent(Intent.ACTION_VIEW); 
intent.setDataAndType(Uri.fromFile(new File(&quot;/sdcard/test.apk&quot;), &quot;application/vnd.android.package-archive&quot;); 

// 在Android Market中查找应用 
Uri uri = Uri.parse(&quot;market://search?q=愤怒的小鸟&quot;);          
Intent intent = new Intent(Intent.ACTION_VIEW, uri);
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/01/基础Demo1--菜单Menu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/01/基础Demo1--菜单Menu/" itemprop="url">基础Demo1-菜单Menu</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-01T00:00:00+08:00">
                2019-04-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、创建item-menu-xml"><a href="#1、创建item-menu-xml" class="headerlink" title="1、创建item_menu.xml"></a>1、创建item_menu.xml</h3><p>：res右键—&gt;Directory—&gt;menu—&gt;item_menu.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;

&lt;item
    android:id=&quot;@+id/scan_item&quot;
    android:title=&quot;扫一扫&quot;/&gt;

&lt;item
    android:id=&quot;@+id/friend_item&quot;
    android:title=&quot;添加朋友&quot;/&gt;

&lt;item
    android:id=&quot;@+id/pay_item&quot;
    android:title=&quot;收付款&quot;/&gt;

&lt;/menu&gt;
</code></pre><h3 id="2、在Activity中重写两个Menu的回调方法"><a href="#2、在Activity中重写两个Menu的回调方法" class="headerlink" title="2、在Activity中重写两个Menu的回调方法"></a>2、在Activity中重写两个Menu的回调方法</h3><p>：（1）onCreateOptionsMenu()，初始化菜单item</p>
<p>：（2）onOptionsItemSelected（），子项选中后的逻辑</p>
<pre><code>import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.Menu;
import android.view.MenuItem;
import android.widget.Toast;

public class MainActivity extends AppCompatActivity {


@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    //调用象方：初始化布局
    setContentView(R.layout.activity_main);
}



//初始化菜单item为view对象
@Override
public boolean onCreateOptionsMenu(Menu menu) {

    //调用象方：构造item_view对象，初始化item布局，参数menu是加载该view的位置，直接使用形参的menu，不用改
    getMenuInflater().inflate(R.menu.item_menu,menu);

    //ture的处理结果是可以显示菜单
    return true;
}

//触摸结果的处理方法，在Android系统的触摸监听里被回调
@Override
public boolean onOptionsItemSelected(MenuItem item) {

    //在触摸回调的时候系统会传入监听到的item对象，我们根据id值来鉴别每个item
    //要时刻记住我们的职责是构造处理类方法，不需要我们调用，是系统调用
    //所以我们关键是写对方法名和形参类型，实际数据是系统自己调用时，自己传进去使用，不需要给我们
    switch (item.getItemId()){

        case R.id.scan_item:

            Toast.makeText(this,&quot;扫一扫&quot;,Toast.LENGTH_SHORT).show();
            break;

        case R.id.friend_item:
            Toast.makeText(this,&quot;添加朋友&quot;,Toast.LENGTH_SHORT).show();
            break;

        case R.id.pay_item:
            Toast.makeText(this,&quot;收付款&quot;,Toast.LENGTH_SHORT).show();
            break;

            default:break;
    }
    //true理解为可以执行
    return true;
  }

}
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/18/MVC模式的Demo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/18/MVC模式的Demo/" itemprop="url">后台09：MVC模式的Demo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-18T00:00:00+08:00">
                2019-03-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>   <img src="/2019/03/18/MVC模式的Demo/110.gif" alt></p>
<h3 id="1-创建数据库"><a href="#1-创建数据库" class="headerlink" title="1.创建数据库"></a>1.创建数据库</h3><p> <img src="/2019/03/18/MVC模式的Demo/1.png" alt></p>
<p> <img src="/2019/03/18/MVC模式的Demo/2.png" alt></p>
<h3 id="2-创建数据的JavaBean"><a href="#2-创建数据的JavaBean" class="headerlink" title="2.创建数据的JavaBean"></a>2.创建数据的JavaBean</h3><pre><code>import java.util.Date;

public class Student {

private int sid;
private String sname;
private String gender;
private String phone;
private Date birthday;
private String hobby;
private String info;



public Student() {
    super();
    // TODO Auto-generated constructor stub
}

public Student( String sname, String gender, String phone, String hobby, String info, Date birthday) {
    super();
    this.sname = sname;
    this.gender = gender;
    this.phone = phone;
    this.hobby = hobby;
    this.info = info;
    this.birthday = birthday;
}

public int getSid() {
    return sid;
}
public void setSid(int sid) {
    this.sid = sid;
}
public String getSname() {
    return sname;
}
public void setSname(String sname) {
    this.sname = sname;
}
public String getGender() {
    return gender;
}
public void setGender(String gender) {
    this.gender = gender;
}
public String getPhone() {
    return phone;
}
public void setPhone(String phone) {
    this.phone = phone;
}
public Date getBirthday() {
    return birthday;
}
public void setBirthday(Date birthday) {
    this.birthday = birthday;
}
public String getHobby() {
    return hobby;
}
public void setHobby(String hobby) {
    this.hobby = hobby;
}
public String getInfo() {
    return info;
}
public void setInfo(String info) {
    this.info = info;
}

}
</code></pre><blockquote>
<p>属性名要和数据库表的字段名一样，才可以解析</p>
</blockquote>
<h3 id="3-创建访问数据的接口Dao和具体实现类"><a href="#3-创建访问数据的接口Dao和具体实现类" class="headerlink" title="3.创建访问数据的接口Dao和具体实现类"></a>3.创建访问数据的接口Dao和具体实现类</h3><blockquote>
<p>好处是接口是架构师可以提前规范设计，具体实现类交给组员分工实现</p>
</blockquote>
<blockquote>
<p>导入JDBC驱动jar包，c3p0 jar包，DBUtils jar包</p>
</blockquote>
<pre><code>import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;

public interface StudentDao {

List&lt;Student&gt; findAll() throws SQLException ;

}






import java.sql.SQLException;
import java.util.List;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.mchange.v2.c3p0.ComboPooledDataSource;

public class StudentDaoImple implements StudentDao {

@Override
public List&lt;Student&gt; findAll() throws SQLException{

    //C3P0创建数据库连接池
    ComboPooledDataSource dataSource = new ComboPooledDataSource();

    //DBUtils从连接池获取连接对象，然后进行CRUD
    QueryRunner queryRunner=new QueryRunner(dataSource);

    List&lt;Student&gt; list=queryRunner.query(&quot;select * from stu&quot;,new BeanListHandler&lt;Student&gt;(Student.class));

    return list;
    }
}
</code></pre><h3 id="4-创建Service"><a href="#4-创建Service" class="headerlink" title="4.创建Service"></a>4.创建Service</h3><blockquote>
<p>Service是对Dao的拓展与调用，Dao是单一逻辑，Service是业务多逻辑</p>
</blockquote>
<pre><code>import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;

public interface StudentService {

    List&lt;Student&gt; findAll() throws SQLException ;
}




import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.feisheng.daoimple.StudentDaoImple;
import com.feisheng.service.StudentService;

public class StudentServiceImple implements StudentService{

@Override
public List&lt;Student&gt; findAll() throws SQLException {


    StudentDao dao=new StudentDaoImple();
    return dao.findAll();
    }    
}
</code></pre><h3 id="5-首页面：index-jsp"><a href="#5-首页面：index-jsp" class="headerlink" title="5.首页面：index.jsp"></a>5.首页面：index.jsp</h3><pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h3&gt; &lt;a href=&quot;StudentListServlet&quot;&gt;点击进入学生列表页面&lt;/a&gt;&lt;/h3&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="6-Servlet访问拿到数据库数据，传入作用域，再跳转页面"><a href="#6-Servlet访问拿到数据库数据，传入作用域，再跳转页面" class="headerlink" title="6.Servlet访问拿到数据库数据，传入作用域，再跳转页面"></a>6.Servlet访问拿到数据库数据，传入作用域，再跳转页面</h3><pre><code>import java.io.IOException;
import java.sql.SQLException;
import java.util.List;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import com.feisheng.bean.Student;
import com.feisheng.service.StudentService;
import com.feisheng.serviceimple.StudentServiceImple;

public class StudentListServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {


    try {
        //1、访问数据库，获取学生数据
        StudentService dao=new StudentServiceImple();
        List&lt;Student&gt; list = dao.findAll();

        //2、数据传入作用域
        request.setAttribute(&quot;list&quot;, list);

        //3、跳转页面
        request.getRequestDispatcher(&quot;list.jsp&quot;).forward(request, response);




    } catch (SQLException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }

}


protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    doGet(request, response);
}

}





&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;  
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;table border=&quot;1&quot; width=&quot;700&quot;&gt;

&lt;tr&gt;
&lt;td&gt;
&lt;a href=&quot;add.jsp&quot;&gt;添加&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;编号&lt;/td&gt;
&lt;td&gt;姓名&lt;/td&gt;
&lt;td&gt;性别&lt;/td&gt;
&lt;td&gt;电话&lt;/td&gt;
&lt;td&gt;生日&lt;/td&gt;
&lt;td&gt;爱好&lt;/td&gt;
&lt;td&gt;简介&lt;/td&gt;
&lt;td&gt;操作&lt;/td&gt;
&lt;/tr&gt;

&lt;c:forEach items=&quot;${list}&quot; var=&quot;student&quot;&gt;
&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;${student.sid}&lt;/td&gt;
&lt;td&gt;${student.sname}&lt;/td&gt;
&lt;td&gt;${student.gender}&lt;/td&gt;
&lt;td&gt;${student.phone}&lt;/td&gt;
&lt;td&gt;${student.birthday}&lt;/td&gt;
&lt;td&gt;${student.hobby}&lt;/td&gt;
&lt;td&gt;${student.info}&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;&quot;&gt;更新&lt;/a&gt;  &lt;a href=&quot;&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;&gt;
&lt;/table&gt;


&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="7、写添加按钮跳转的add-jsp页面"><a href="#7、写添加按钮跳转的add-jsp页面" class="headerlink" title="7、写添加按钮跳转的add.jsp页面"></a>7、写添加按钮跳转的add.jsp页面</h3><pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;添加学生页面&lt;/title&gt;

&lt;/head&gt;


&lt;body&gt;

&lt;h3&gt;添加学生页面&lt;/h3&gt;

&lt;form method=&quot;post&quot; action=&quot;AddServlet&quot;&gt;
  &lt;table border=&quot;1&quot; width=&quot;600&quot;&gt;
  &lt;tr&gt;
&lt;td&gt;姓名&lt;/td&gt;
&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;sname&quot;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;性别&lt;/td&gt;
&lt;td&gt;
    &lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;男&quot;&gt;男
    &lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;女&quot;&gt;女
&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;电话&lt;/td&gt;
&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;phone&quot;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;生日&lt;/td&gt;
&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;birthday&quot;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;爱好&lt;/td&gt;
&lt;td&gt;
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;游泳&quot;&gt;游泳
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;篮球&quot;&gt;篮球
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;足球&quot;&gt;足球
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;看书&quot;&gt;看书
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;写字&quot;&gt;写字

&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;简介&lt;/td&gt;
&lt;td&gt;&lt;textarea name=&quot;info&quot; rows=&quot;3&quot; cols=&quot;20&quot;&gt;&lt;/textarea&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td colspan=&quot;2&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;添加&quot;&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;/table&gt;
   &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="8、提交表单之后发送数据到了AddServlet-java文件"><a href="#8、提交表单之后发送数据到了AddServlet-java文件" class="headerlink" title="8、提交表单之后发送数据到了AddServlet.java文件"></a>8、提交表单之后发送数据到了AddServlet.java文件</h3><pre><code>import java.io.IOException;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Arrays;
import java.util.Date;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import com.feisheng.bean.Student;
import com.feisheng.service.StudentService;
import com.feisheng.serviceimple.StudentServiceImple;

/**
     * 用于处理学生的添加请求
         * @author xiaomi
 *
 */
public class AddServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    request.setCharacterEncoding(&quot;UTF-8&quot;);


    try {

        //1. 获取客户端提交上来的数据
        String sname = request.getParameter(&quot;sname&quot;); //sname:zhangsan
        String gender = request.getParameter(&quot;gender&quot;);
        String phone = request.getParameter(&quot;phone&quot;);
        String birthday = request.getParameter(&quot;birthday&quot;); // 1989-10-18
        String info = request.getParameter(&quot;info&quot;);
        //String hobby = request.getParameter(&quot;hobby&quot;);//hobby : 游泳，写字， 足球。
        String [] h  = request.getParameterValues(&quot;hobby&quot;);
    //            [篮球，足球，写字] --- 篮球，足球，写字

        String hobby = Arrays.toString(h);
        hobby = hobby.substring(1, hobby.length()-1);

        //2. 添加到数据库
        //string -- date
        Date date= new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(birthday);

        Student student = new Student(sname, gender, phone, hobby, info, date);
        StudentService service = new StudentServiceImple();
        service.insert(student);

        //3. 跳转到列表页
        //再查一次数据库，然后再装到作用域中 ，然后再跳转。
        //这里是直接跳转到页面上， 那么这个页面会重新翻译一次，上面的那个request的请求存放的数据是没有了。 
        //request.getRequestDispatcher(&quot;list.jsp&quot;).forward(request, response);

        //servlet除了能跳jsp之外。 还能跳servlet
        request.getRequestDispatcher(&quot;StudentListServlet&quot;).forward(request, response);

    } catch (Exception e) {
        e.printStackTrace();
    }
}


/**
 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
 */
protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // TODO Auto-generated method stub
    doGet(request, response);
        }
}
</code></pre><h3 id="9-现在是要添加删除按钮的功能，为-lt-a添加onClick的脚本JS函数"><a href="#9-现在是要添加删除按钮的功能，为-lt-a添加onClick的脚本JS函数" class="headerlink" title="9.现在是要添加删除按钮的功能，为&lt;a添加onClick的脚本JS函数"></a>9.现在是要添加删除按钮的功能，为&lt;a添加onClick的脚本JS函数</h3><pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;

&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;


&lt;script type=&quot;text/javascript&quot;&gt;

function doDelete(sid) {
    /* 如果这里弹出的对话框，用户点击的是确定，就马上去请求Servlet。 
    如何知道用户点击的是确定。
    如何在js的方法中请求servlet。 */
    var flag = confirm(&quot;是否确定删除?&quot;);
    if(flag){
        //表明点了确定。 访问servlet。 在当前标签页上打开 超链接，
        //window.location.href=&quot;DeleteServlet?sid=&quot;+sid;

        location.href=&quot;DeleteServlet?sid=&quot;+sid;
    }
}
&lt;/script&gt;


&lt;/head&gt;
&lt;body&gt;

&lt;table border=&quot;1&quot; width=&quot;700&quot;&gt;

&lt;tr&gt;
&lt;td&gt;
&lt;a href=&quot;add.jsp&quot;&gt;添加&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;编号&lt;/td&gt;
&lt;td&gt;姓名&lt;/td&gt;
&lt;td&gt;性别&lt;/td&gt;
&lt;td&gt;电话&lt;/td&gt;
&lt;td&gt;生日&lt;/td&gt;
&lt;td&gt;爱好&lt;/td&gt;
&lt;td&gt;简介&lt;/td&gt;
&lt;td&gt;操作&lt;/td&gt;
&lt;/tr&gt;

&lt;c:forEach items=&quot;${list}&quot; var=&quot;student&quot;&gt;
&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;${student.sid}&lt;/td&gt;
&lt;td&gt;${student.sname}&lt;/td&gt;
&lt;td&gt;${student.gender}&lt;/td&gt;
&lt;td&gt;${student.phone}&lt;/td&gt;
&lt;td&gt;${student.birthday}&lt;/td&gt;
&lt;td&gt;${student.hobby}&lt;/td&gt;
&lt;td&gt;${student.info}&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;&quot;&gt;更新&lt;/a&gt; &lt;a href=&quot;#&quot; onclick=&quot;doDelete(${student.sid})&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="10-脚本函数最终是将数据库元素的id传给了Servlet，要新建一个Servlet来处理"><a href="#10-脚本函数最终是将数据库元素的id传给了Servlet，要新建一个Servlet来处理" class="headerlink" title="10.脚本函数最终是将数据库元素的id传给了Servlet，要新建一个Servlet来处理"></a>10.脚本函数最终是将数据库元素的id传给了Servlet，要新建一个Servlet来处理</h3><pre><code>import java.io.IOException;
import java.sql.SQLException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import com.feisheng.service.StudentService;
import com.feisheng.serviceimple.StudentServiceImple;

public class DeleteServlet extends HttpServlet {
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    try {
        //1. 接收id
        int sid = Integer.parseInt(request.getParameter(&quot;sid&quot;));

        //2. 执行删除
        StudentService service = new StudentServiceImple();
        service.delete(sid);

        //3. 跳转到列表页。
        request.getRequestDispatcher(&quot;StudentListServlet&quot;).forward(request, response);

    } catch (Exception e) {
        e.printStackTrace();
    }

}

/**
 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
 */
protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // TODO Auto-generated method stub
    doGet(request, response);
        }
    }
</code></pre><h3 id="11-因为是用Dao接口来处理数据库的，所以上面的Servlet需要搭配Dao"><a href="#11-因为是用Dao接口来处理数据库的，所以上面的Servlet需要搭配Dao" class="headerlink" title="11.因为是用Dao接口来处理数据库的，所以上面的Servlet需要搭配Dao"></a>11.因为是用Dao接口来处理数据库的，所以上面的Servlet需要搭配Dao</h3><pre><code>import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;

public interface StudentDao {

List&lt;Student&gt; findAll() throws SQLException ;

void insert(Student student) throws SQLException ;

void delete(int sid) throws SQLException ;
}





import java.sql.SQLException;
import java.util.List;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.mchange.v2.c3p0.ComboPooledDataSource;


public class StudentDaoImple implements StudentDao {

@Override
public List&lt;Student&gt; findAll() throws SQLException{

    //C3P0创建数据库连接池
    ComboPooledDataSource dataSource = new ComboPooledDataSource();

    //DBUtils从连接池获取连接对象，然后进行CRUD
    QueryRunner queryRunner=new QueryRunner(dataSource);

    List&lt;Student&gt; list=queryRunner.query(&quot;select * from stu&quot;,new BeanListHandler&lt;Student&gt;(Student.class));

    return list;
}

@Override
public void insert(Student student) throws SQLException {
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());

    runner.update(&quot;insert into stu values(null , ?,?,?,?,?,?)&quot; ,
            student.getSname(),
            student.getGender(),
            student.getPhone(),
            student.getBirthday(),
            student.getHobby(),
            student.getInfo()
            );
}

@Override
public void delete(int sid) throws SQLException {
    // TODO Auto-generated method stub
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());
    runner.update(&quot;delete from stu where sid=?&quot;,sid);
    }

}





import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;

public interface StudentService {

List&lt;Student&gt; findAll() throws SQLException ;
void insert(Student student)throws SQLException;

void delete(int sid) throws SQLException ;
}





import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.feisheng.daoimple.StudentDaoImple;
import com.feisheng.service.StudentService;

public class StudentServiceImple implements StudentService{

@Override
public List&lt;Student&gt; findAll() throws SQLException {
    StudentDao dao = new StudentDaoImple();
    return dao.findAll();
}

@Override
public void insert(Student student) throws SQLException {
    StudentDao dao = new StudentDaoImple();
    dao.insert(student);
}

@Override
public void delete(int sid) throws SQLException {
    // TODO Auto-generated method stub

    StudentDao dao=new StudentDaoImple();
    dao.delete(sid);
        }
}
</code></pre><h3 id="12-更新功能：先给list-jsp添加update按钮的超链接"><a href="#12-更新功能：先给list-jsp添加update按钮的超链接" class="headerlink" title="12.更新功能：先给list.jsp添加update按钮的超链接"></a>12.更新功能：先给list.jsp添加update按钮的超链接</h3><pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;

&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;


&lt;script type=&quot;text/javascript&quot;&gt;

function doDelete(sid) {
    /* 如果这里弹出的对话框，用户点击的是确定，就马上去请求Servlet。 
    如何知道用户点击的是确定。
    如何在js的方法中请求servlet。 */
    var flag = confirm(&quot;是否确定删除?&quot;);
    if(flag){
        //表明点了确定。 访问servlet。 在当前标签页上打开 超链接，
        //window.location.href=&quot;DeleteServlet?sid=&quot;+sid;

        location.href=&quot;DeleteServlet?sid=&quot;+sid;
    }
}
&lt;/script&gt;


&lt;/head&gt;
&lt;body&gt;

&lt;table border=&quot;1&quot; width=&quot;700&quot;&gt;

&lt;tr&gt;
&lt;td&gt;
&lt;a href=&quot;add.jsp&quot;&gt;添加&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;编号&lt;/td&gt;
&lt;td&gt;姓名&lt;/td&gt;
&lt;td&gt;性别&lt;/td&gt;
&lt;td&gt;电话&lt;/td&gt;
&lt;td&gt;生日&lt;/td&gt;
&lt;td&gt;爱好&lt;/td&gt;
&lt;td&gt;简介&lt;/td&gt;
&lt;td&gt;操作&lt;/td&gt;
&lt;/tr&gt;

&lt;c:forEach items=&quot;${list}&quot; var=&quot;student&quot;&gt;
&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;${student.sid}&lt;/td&gt;
&lt;td&gt;${student.sname}&lt;/td&gt;
&lt;td&gt;${student.gender}&lt;/td&gt;
&lt;td&gt;${student.phone}&lt;/td&gt;
&lt;td&gt;${student.birthday}&lt;/td&gt;
&lt;td&gt;${student.hobby}&lt;/td&gt;
&lt;td&gt;${student.info}&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;EditServlet?sid=${student.sid }&quot;&gt;更新&lt;/a&gt; &lt;a href=&quot;#&quot; onclick=&quot;doDelete(${student.sid})&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;
&lt;/table&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="把此对象元素的数据库id值传给Servlet进行查询"><a href="#把此对象元素的数据库id值传给Servlet进行查询" class="headerlink" title="把此对象元素的数据库id值传给Servlet进行查询"></a>把此对象元素的数据库id值传给Servlet进行查询</h3><pre><code>import java.io.IOException;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import java.util.Arrays;
import java.util.Date;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import com.feisheng.bean.Student;
import com.feisheng.service.StudentService;
import com.feisheng.serviceimple.StudentServiceImple;

/**
 * Servlet implementation class EditServlet
 */
public class EditServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {


    request.setCharacterEncoding(&quot;UTF-8&quot;);

    try {
        //1. 接收id
        int sid = Integer.parseInt(request.getParameter(&quot;sid&quot;));

        //2. 查询学生数据
        StudentService service = new StudentServiceImple();
        Student stu = service.findStudentById(sid);

        //3. 显示数据
        //存数据bean到作用域
        request.setAttribute(&quot;stu&quot;, stu);
        //跳转
        request.getRequestDispatcher(&quot;edit.jsp&quot;).forward(request, response);

    } catch (SQLException e) {
        e.printStackTrace();
    }

}

/**
 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
 */
protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // TODO Auto-generated method stub
    doGet(request, response);
    }

}
</code></pre><p>搭配Dao接口才能查数据</p>
<pre><code>import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;

public interface StudentDao {

List&lt;Student&gt; findAll() throws SQLException ;

void insert(Student student) throws SQLException ;

void delete(int sid) throws SQLException ;

Student findStudentById(int sid)throws SQLException ;

void update (Student student )throws SQLException ;
}





import java.sql.SQLException;
import java.util.List;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.mchange.v2.c3p0.ComboPooledDataSource;


public class StudentDaoImple implements StudentDao {

@Override
public List&lt;Student&gt; findAll() throws SQLException{

    //C3P0创建数据库连接池
    ComboPooledDataSource dataSource = new ComboPooledDataSource();

    //DBUtils从连接池获取连接对象，然后进行CRUD
    QueryRunner queryRunner=new QueryRunner(dataSource);

    List&lt;Student&gt; list=queryRunner.query(&quot;select * from stu&quot;,new BeanListHandler&lt;Student&gt;(Student.class));

    return list;
}

@Override
public void insert(Student student) throws SQLException {
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());

    runner.update(&quot;insert into stu values(null , ?,?,?,?,?,?)&quot; ,
            student.getSname(),
            student.getGender(),
            student.getPhone(),
            student.getBirthday(),
            student.getHobby(),
            student.getInfo()
            );
}

@Override
public void delete(int sid) throws SQLException {
    // TODO Auto-generated method stub
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());
    runner.update(&quot;delete from stu where sid=?&quot;,sid);
}

@Override
public Student findStudentById(int sid) throws SQLException {

    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());
    return runner.query(&quot;select * from stu where sid = ?&quot;, new BeanHandler&lt;Student&gt;(Student.class) ,sid);
}

@Override
public void update(Student student) throws SQLException {
    // TODO Auto-generated method stub
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());

    runner.update(&quot;update stu set sname=? , gender=? , phone=? , birthday=? , hobby=? , info=? where sid = ?&quot;, 
            student.getSname(),
            student.getGender(),
            student.getPhone(),
            student.getBirthday(),
            student.getHobby(),
            student.getInfo(),
            student.getSid());
        }    
}




import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;

public interface StudentService {

List&lt;Student&gt; findAll() throws SQLException ;
void insert(Student student)throws SQLException;

void delete(int sid) throws SQLException ;

Student findStudentById(int sid)throws SQLException ;

void update (Student student )throws SQLException ;
}




import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.feisheng.daoimple.StudentDaoImple;
import com.feisheng.service.StudentService;

public class StudentServiceImple implements StudentService{

@Override
public List&lt;Student&gt; findAll() throws SQLException {
    StudentDao dao = new StudentDaoImple();
    return dao.findAll();
}

@Override
public void insert(Student student) throws SQLException {
    StudentDao dao = new StudentDaoImple();
    dao.insert(student);
}

@Override
public void delete(int sid) throws SQLException {
    // TODO Auto-generated method stub

    StudentDao dao=new StudentDaoImple();
    dao.delete(sid);
}

@Override
public Student findStudentById(int sid) throws SQLException {

    StudentDao dao=new StudentDaoImple();
    return dao.findStudentById(sid);
}

@Override
public void update(Student student) throws SQLException {
    // TODO Auto-generated method stub
    StudentDao dao=new StudentDaoImple();
    dao.update(student);
        }
}
</code></pre><h3 id="再把数据库查到数据封装成bean对象，存在作用域，然后在edit-jsp显示"><a href="#再把数据库查到数据封装成bean对象，存在作用域，然后在edit-jsp显示" class="headerlink" title="再把数据库查到数据封装成bean对象，存在作用域，然后在edit.jsp显示"></a>再把数据库查到数据封装成bean对象，存在作用域，然后在edit.jsp显示</h3><pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;

 &lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
 &lt;%@ taglib prefix=&quot;fn&quot; uri=&quot;http://java.sun.com/jsp/jstl/functions&quot; %&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/    loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;更新学生页面&lt;/title&gt;

&lt;/head&gt;


&lt;body&gt;

&lt;h3&gt;更新学生页面&lt;/h3&gt;

&lt;form method=&quot;post&quot; action=&quot;UpdateServlet&quot;&gt;

&lt;input type=&quot;hidden&quot; name=&quot;sid&quot; value=&quot;${stu.sid }&quot;&gt;

  &lt;table border=&quot;1&quot; width=&quot;600&quot;&gt;
  &lt;tr&gt;
&lt;td&gt;姓名&lt;/td&gt;
&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;sname&quot; value=&quot;${stu.sname }&quot;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;性别&lt;/td&gt;
&lt;td&gt;
    &lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;男&quot; &lt;c:if test=&quot;${stu.gender == &apos;男&apos;}&quot;&gt;checked&lt;/c:if&gt;&gt;男
    &lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;女&quot; &lt;c:if test=&quot;${stu.gender == &apos;女&apos;}&quot;&gt;checked&lt;/c:if&gt;&gt;女
&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;电话&lt;/td&gt;
&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;phone&quot;  value=&quot;${stu.phone }&quot;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;生日&lt;/td&gt;
&lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;birthday&quot; value=&quot;${stu.birthday }&quot;&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;爱好&lt;/td&gt;
&lt;td&gt;
    &lt;!-- 爱好： 篮球 ， 足球 ， 看书 
    因为爱好有很多个，  里面存在包含的关系 --&gt;
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;游泳&quot; &lt;c:if test=&quot;${fn:contains(stu.hobby,&apos;游泳&apos;) }&quot;&gt;checked&lt;/c:if&gt;&gt;游泳
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;篮球&quot; &lt;c:if test=&quot;${fn:contains(stu.hobby,&apos;篮球&apos;) }&quot;&gt;checked&lt;/c:if&gt;&gt;篮球
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;足球&quot; &lt;c:if test=&quot;${fn:contains(stu.hobby,&apos;足球&apos;) }&quot;&gt;checked&lt;/c:if&gt;&gt;足球
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;看书&quot; &lt;c:if test=&quot;${fn:contains(stu.hobby,&apos;看书&apos;) }&quot;&gt;checked&lt;/c:if&gt;&gt;看书
    &lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;写字&quot; &lt;c:if test=&quot;${fn:contains(stu.hobby,&apos;写字&apos;) }&quot;&gt;checked&lt;/c:if&gt;&gt;写字

&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td&gt;简介&lt;/td&gt;
&lt;td&gt;&lt;textarea name=&quot;info&quot; rows=&quot;3&quot; cols=&quot;20&quot;&gt;${stu.info }&lt;/textarea&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
&lt;td colspan=&quot;2&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;更新&quot;&gt; &lt;/td&gt;
  &lt;/tr&gt;
  &lt;/table&gt;
   &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="最后再到UpdateServlate重新读取更新数据库数据，再重新读取显示一遍"><a href="#最后再到UpdateServlate重新读取更新数据库数据，再重新读取显示一遍" class="headerlink" title="最后再到UpdateServlate重新读取更新数据库数据，再重新读取显示一遍"></a>最后再到UpdateServlate重新读取更新数据库数据，再重新读取显示一遍</h3><pre><code>import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Arrays;
import java.util.Date;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import com.feisheng.bean.Student;
import com.feisheng.service.StudentService;
import com.feisheng.serviceimple.StudentServiceImple;

/**
 * Servlet implementation class UpdateServlet
 */
public class UpdateServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    request.setCharacterEncoding(&quot;UTF-8&quot;);
    try {
        //1. 获取客户端提交上来的数据
        int sid = Integer.parseInt(request.getParameter(&quot;sid&quot;));
        String sname = request.getParameter(&quot;sname&quot;); //sname:zhangsan
        String gender = request.getParameter(&quot;gender&quot;);
        String phone = request.getParameter(&quot;phone&quot;);
        String birthday = request.getParameter(&quot;birthday&quot;); // 1989-10-18
        String info = request.getParameter(&quot;info&quot;);
        //String hobby = request.getParameter(&quot;hobby&quot;);//hobby : 游泳，写字， 足球。
        String[] h = request.getParameterValues(&quot;hobby&quot;);
        //        [篮球，足球，写字] --- 篮球，足球，写字
        String hobby = Arrays.toString(h);
        hobby = hobby.substring(1, hobby.length() - 1);
        //2. 添加到数据库
        //string -- date
        Date date = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;).parse(birthday);
        Student student = new Student(sid ,sname, gender, phone, hobby, info, date);

        //2. 更新数据库数据
        StudentService service = new StudentServiceImple();
        service.update(student);

        //3. 跳转界面
        request.getRequestDispatcher(&quot;StudentListServlet&quot;).forward(request, response);
    } catch (Exception e) {
        e.printStackTrace();
    }



}

/**
 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
 */
protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // TODO Auto-generated method stub
    doGet(request, response);
    }
}
</code></pre><h3 id="模糊查询：现在先改一下list-jsp的页面布局，增加查询按钮"><a href="#模糊查询：现在先改一下list-jsp的页面布局，增加查询按钮" class="headerlink" title="模糊查询：现在先改一下list.jsp的页面布局，增加查询按钮"></a>模糊查询：现在先改一下list.jsp的页面布局，增加查询按钮</h3><pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;

&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;


&lt;script type=&quot;text/javascript&quot;&gt;

function doDelete(sid) {
    /* 如果这里弹出的对话框，用户点击的是确定，就马上去请求Servlet。 
    如何知道用户点击的是确定。
    如何在js的方法中请求servlet。 */
    var flag = confirm(&quot;是否确定删除?&quot;);
    if(flag){
        //表明点了确定。 访问servlet。 在当前标签页上打开 超链接，
        //window.location.href=&quot;DeleteServlet?sid=&quot;+sid;

        location.href=&quot;DeleteServlet?sid=&quot;+sid;
    }
}
&lt;/script&gt;


&lt;/head&gt;
&lt;body&gt;

&lt;table border=&quot;1&quot; width=&quot;700&quot;&gt;

&lt;tr&gt;
&lt;td colspan=&quot;8&quot;&gt;

按姓名查询：&lt;input type=&quot;text&quot; name=&quot;sname&quot;/&gt;

按性别查询：&lt;select name=&quot;sgender&quot;&gt;
      &lt;option value=&quot;--请选择--&quot;&gt;--请选择--
      &lt;option value=&quot;男&quot;&gt;男
      &lt;option value=&quot;女&quot;&gt;女
      &lt;/select&gt;

      &amp;nbsp;&amp;nbsp;&amp;nbsp;

     &lt;input type=&quot;submit&quot; value=&quot;查询&quot;&gt;

     &lt;a href=&quot;add.jsp&quot;&gt;添加&lt;/a&gt;

&lt;/td&gt;
&lt;/tr&gt;



&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;编号&lt;/td&gt;
&lt;td&gt;姓名&lt;/td&gt;
&lt;td&gt;性别&lt;/td&gt;
&lt;td&gt;电话&lt;/td&gt;
&lt;td&gt;生日&lt;/td&gt;
&lt;td&gt;爱好&lt;/td&gt;
&lt;td&gt;简介&lt;/td&gt;
&lt;td&gt;操作&lt;/td&gt;
&lt;/tr&gt;

&lt;c:forEach items=&quot;${list}&quot; var=&quot;student&quot;&gt;
&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;${student.sid}&lt;/td&gt;
&lt;td&gt;${student.sname}&lt;/td&gt;
&lt;td&gt;${student.gender}&lt;/td&gt;
&lt;td&gt;${student.phone}&lt;/td&gt;
&lt;td&gt;${student.birthday}&lt;/td&gt;
&lt;td&gt;${student.hobby}&lt;/td&gt;
&lt;td&gt;${student.info}&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;EditServlet?sid=${student.sid }&quot;&gt;更新&lt;/a&gt; &lt;a href=&quot;#&quot; onclick=&quot;doDelete(${student.sid})&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;
&lt;/table&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="为查询按钮增加submit功能，那就需要一个-lt-form表单控件，post提交参数值到Servlet进行处理"><a href="#为查询按钮增加submit功能，那就需要一个-lt-form表单控件，post提交参数值到Servlet进行处理" class="headerlink" title="为查询按钮增加submit功能，那就需要一个&lt;form表单控件，post提交参数值到Servlet进行处理"></a>为查询按钮增加submit功能，那就需要一个&lt;form表单控件，post提交参数值到Servlet进行处理</h3><pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;

&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;


&lt;script type=&quot;text/javascript&quot;&gt;

function doDelete(sid) {
    /* 如果这里弹出的对话框，用户点击的是确定，就马上去请求Servlet。 
    如何知道用户点击的是确定。
    如何在js的方法中请求servlet。 */
    var flag = confirm(&quot;是否确定删除?&quot;);
    if(flag){
        //表明点了确定。 访问servlet。 在当前标签页上打开 超链接，
        //window.location.href=&quot;DeleteServlet?sid=&quot;+sid;

        location.href=&quot;DeleteServlet?sid=&quot;+sid;
    }
}
&lt;/script&gt;


&lt;/head&gt;
&lt;body&gt;

&lt;form action=&quot;SearchStudentServlet&quot; method=&quot;post&quot;&gt;
&lt;table border=&quot;1&quot; width=&quot;700&quot;&gt;

&lt;tr&gt;
&lt;td colspan=&quot;8&quot;&gt;

按姓名查询：&lt;input type=&quot;text&quot; name=&quot;sname&quot;/&gt;

按性别查询：&lt;select name=&quot;sgender&quot;&gt;
      &lt;option value=&quot;&quot;&gt;--请选择--
      &lt;option value=&quot;男&quot;&gt;男
      &lt;option value=&quot;女&quot;&gt;女
      &lt;/select&gt;

      &amp;nbsp;&amp;nbsp;&amp;nbsp;

     &lt;input type=&quot;submit&quot; value=&quot;查询&quot;&gt;

     &lt;a href=&quot;add.jsp&quot;&gt;添加&lt;/a&gt;        
&lt;/td&gt;
&lt;/tr&gt;

&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;编号&lt;/td&gt;
&lt;td&gt;姓名&lt;/td&gt;
&lt;td&gt;性别&lt;/td&gt;
&lt;td&gt;电话&lt;/td&gt;
&lt;td&gt;生日&lt;/td&gt;
&lt;td&gt;爱好&lt;/td&gt;
&lt;td&gt;简介&lt;/td&gt;
&lt;td&gt;操作&lt;/td&gt;
&lt;/tr&gt;

&lt;c:forEach items=&quot;${list}&quot; var=&quot;student&quot;&gt;
&lt;tr align=&quot;center&quot;&gt;
&lt;td&gt;${student.sid}&lt;/td&gt;
&lt;td&gt;${student.sname}&lt;/td&gt;
&lt;td&gt;${student.gender}&lt;/td&gt;
&lt;td&gt;${student.phone}&lt;/td&gt;
&lt;td&gt;${student.birthday}&lt;/td&gt;
&lt;td&gt;${student.hobby}&lt;/td&gt;
&lt;td&gt;${student.info}&lt;/td&gt;
&lt;td&gt;&lt;a href=&quot;EditServlet?sid=${student.sid }&quot;&gt;更新&lt;/a&gt; &lt;a href=&quot;#&quot; onclick=&quot;doDelete(${student.sid})&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;
&lt;/table&gt;
&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Servlet处理</p>
<pre><code>import java.io.IOException;
import java.sql.SQLException;
import java.util.List;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import com.feisheng.bean.Student;
import com.feisheng.service.StudentService;
import com.feisheng.serviceimple.StudentServiceImple;

/**
 * Servlet implementation class SearchStudentServlet
 */
public class SearchStudentServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    request.setCharacterEncoding(&quot;UTF-8&quot;);
    try {

        //取到要查询的条件值
        String sname=request.getParameter(&quot;sname&quot;);
        String sgender=request.getParameter(&quot;sgender&quot;);

        //Service的dao去查询
        StudentService service=new StudentServiceImple();
        List&lt;Student&gt; list = service.searchStudent(sname, sgender);

        //跳转界面
        request.setAttribute(&quot;list&quot;, list);
        request.getRequestDispatcher(&quot;list.jsp&quot;).forward(request, response);
    } catch (SQLException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }
}

/**
 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
 */
protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // TODO Auto-generated method stub
    doGet(request, response);
    }
}
</code></pre><p>Servlet搭配Dao</p>
<pre><code>import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;

public interface StudentDao {

List&lt;Student&gt; findAll() throws SQLException ;

void insert(Student student) throws SQLException ;

void delete(int sid) throws SQLException ;

Student findStudentById(int sid)throws SQLException ;

void update (Student student )throws SQLException ;

List&lt;Student&gt; searchStudent(String sname,String sgender) throws SQLException;
}



import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.feisheng.utils.TextUtils;
import com.mchange.v2.c3p0.ComboPooledDataSource;


public class StudentDaoImple implements StudentDao {

@Override
public List&lt;Student&gt; findAll() throws SQLException{

    //C3P0创建数据库连接池
    ComboPooledDataSource dataSource = new ComboPooledDataSource();

    //DBUtils从连接池获取连接对象，然后进行CRUD
    QueryRunner queryRunner=new QueryRunner(dataSource);

    List&lt;Student&gt; list=queryRunner.query(&quot;select * from stu&quot;,new BeanListHandler&lt;Student&gt;(Student.class));

    return list;
}

@Override
public void insert(Student student) throws SQLException {
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());

    runner.update(&quot;insert into stu values(null , ?,?,?,?,?,?)&quot; ,
            student.getSname(),
            student.getGender(),
            student.getPhone(),
            student.getBirthday(),
            student.getHobby(),
            student.getInfo()
            );
}

@Override
public void delete(int sid) throws SQLException {
    // TODO Auto-generated method stub
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());
    runner.update(&quot;delete from stu where sid=?&quot;,sid);
}

@Override
public Student findStudentById(int sid) throws SQLException {

    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());
    return runner.query(&quot;select * from stu where sid = ?&quot;, new BeanHandler&lt;Student&gt;(Student.class) ,sid);
}

@Override
public void update(Student student) throws SQLException {
    // TODO Auto-generated method stub
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());

    runner.update(&quot;update stu set sname=? , gender=? , phone=? , birthday=? , hobby=? , info=? where sid = ?&quot;, 
            student.getSname(),
            student.getGender(),
            student.getPhone(),
            student.getBirthday(),
            student.getHobby(),
            student.getInfo(),
            student.getSid());
}

@Override
public List&lt;Student&gt; searchStudent(String sname, String sgender) throws SQLException {
    System.out.println(&quot;现在要执行模糊查询了，收到的name =&quot;+sname + &quot;==genser==&quot;+sgender);

    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());


    /*
     * 这里要分析一下：
     *     如果只有姓名 ，select * from stu where sname like ? ;
     *     如果只有性别 ， select * from stu where gender = ?
     * 
     * 如果两个都有 select * from stu where sname like ? and gender=?
     * 
     * 如果两个都没有就查询所有。
     * 
     */
    String sql = &quot;select * from stu where 1=1 &quot;;
    List&lt;String&gt; list = new ArrayList&lt;String&gt; ();

    //判断有没有姓名， 如果有，就组拼到sql语句里面，%是因为与like的固定搭配
    if(!TextUtils.isEmpty(sname)){
        sql = sql + &quot;  and sname like ?&quot;;
        list.add(&quot;%&quot;+sname+&quot;%&quot;);
    }

    //判断有没有性别，有的话，就组拼到sql语句里面。
    if(!TextUtils.isEmpty(sgender)){
        sql = sql + &quot; and gender = ?&quot;;
        list.add(sgender);
    }


    return runner.query(sql , new BeanListHandler&lt;Student&gt;(Student.class) ,list.toArray() );        
    }

}


import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;

public interface StudentService {

List&lt;Student&gt; findAll() throws SQLException ;
void insert(Student student)throws SQLException;

void delete(int sid) throws SQLException ;

Student findStudentById(int sid)throws SQLException ;

void update (Student student )throws SQLException ;

List&lt;Student&gt; searchStudent(String sname,String sgender) throws SQLException;
}





import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.feisheng.daoimple.StudentDaoImple;
import com.feisheng.service.StudentService;

public class StudentServiceImple implements StudentService{

@Override
public List&lt;Student&gt; findAll() throws SQLException {
    StudentDao dao = new StudentDaoImple();
    return dao.findAll();
}

@Override
public void insert(Student student) throws SQLException {
    StudentDao dao = new StudentDaoImple();
    dao.insert(student);
}

@Override
public void delete(int sid) throws SQLException {
    // TODO Auto-generated method stub

    StudentDao dao=new StudentDaoImple();
    dao.delete(sid);
}

@Override
public Student findStudentById(int sid) throws SQLException {

    StudentDao dao=new StudentDaoImple();
    return dao.findStudentById(sid);
}

@Override
public void update(Student student) throws SQLException {
    // TODO Auto-generated method stub
    StudentDao dao=new StudentDaoImple();
    dao.update(student);
}

@Override
public List&lt;Student&gt; searchStudent(String sname, String sgender) throws SQLException {

    StudentDao dao=new StudentDaoImple();
    return dao.searchStudent(sname, sgender);
    }
}
</code></pre><h3 id="分页查询：首先在index-jsp提供超链接入口"><a href="#分页查询：首先在index-jsp提供超链接入口" class="headerlink" title="分页查询：首先在index.jsp提供超链接入口"></a>分页查询：首先在index.jsp提供超链接入口</h3><pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h3&gt; &lt;a href=&quot;StudentListServlet&quot;&gt;点击进入学生列表页面&lt;/a&gt;&lt;/h3&gt;

&lt;h3&gt;&lt;a href=&quot;StudentListPageServlet?currentPage=1&quot;&gt;分页显示所有学生&lt;/a&gt;&lt;/h3&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h3 id="点击之后先进入Servlet处理，主要是获取数据库的数据，然后存到作用域，再进行跳转显示"><a href="#点击之后先进入Servlet处理，主要是获取数据库的数据，然后存到作用域，再进行跳转显示" class="headerlink" title="点击之后先进入Servlet处理，主要是获取数据库的数据，然后存到作用域，再进行跳转显示"></a>点击之后先进入Servlet处理，主要是获取数据库的数据，然后存到作用域，再进行跳转显示</h3><pre><code>import java.io.IOException;
import java.sql.SQLException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import com.feisheng.bean.PageBean;
import com.feisheng.service.StudentService;
import com.feisheng.serviceimple.StudentServiceImple;

/**
 * 这是用于分页显示学生列表的servlet
 * @author xiaomi
 *
 */
public class StudentListPageServlet extends HttpServlet {
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {


    try {
        //1. 获取需要显示的页码数
        int currentPage =Integer.parseInt( request.getParameter(&quot;currentPage&quot;));

        //2. 根据指定的页数，去获取该页的数据回来
        //List&lt;Student&gt; --- list.jsp

        StudentService service = new StudentServiceImple();
        PageBean pageBean= service.findStudentByPage(currentPage);
        request.setAttribute(&quot;pageBean&quot;, pageBean);
        //3. 跳转界面。
        request.getRequestDispatcher(&quot;list_page.jsp&quot;).forward(request, response);
    } catch (SQLException e) {
        e.printStackTrace();
    }


}

/**
 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
 */
protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // TODO Auto-generated method stub
    doGet(request, response);
        }
}
</code></pre><p>搭配Dao来实现</p>
<pre><code>import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.Student;

public interface StudentDao {

List&lt;Student&gt; findAll() throws SQLException ;

void insert(Student student) throws SQLException ;

void delete(int sid) throws SQLException ;

Student findStudentById(int sid)throws SQLException ;

void update (Student student )throws SQLException ;

List&lt;Student&gt; searchStudent(String sname,String sgender) throws SQLException;

List&lt;Student&gt; findStudentByPage(int currentPage) throws SQLException;


/**
 * 查询总的学生记录数
 * @return
 * @throws SQLException
 */
int findCount()throws SQLException ;

}



import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;
import org.apache.commons.dbutils.handlers.ScalarHandler;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.feisheng.utils.TextUtils;
import com.mchange.v2.c3p0.ComboPooledDataSource;


public class StudentDaoImple implements StudentDao {

@Override
public List&lt;Student&gt; findAll() throws SQLException{

    //C3P0创建数据库连接池
    ComboPooledDataSource dataSource = new ComboPooledDataSource();

    //DBUtils从连接池获取连接对象，然后进行CRUD
    QueryRunner queryRunner=new QueryRunner(dataSource);

    List&lt;Student&gt; list=queryRunner.query(&quot;select * from stu&quot;,new BeanListHandler&lt;Student&gt;(Student.class));

    return list;
}

@Override
public void insert(Student student) throws SQLException {
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());

    runner.update(&quot;insert into stu values(null , ?,?,?,?,?,?)&quot; ,
            student.getSname(),
            student.getGender(),
            student.getPhone(),
            student.getBirthday(),
            student.getHobby(),
            student.getInfo()
            );
}

@Override
public void delete(int sid) throws SQLException {
    // TODO Auto-generated method stub
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());
    runner.update(&quot;delete from stu where sid=?&quot;,sid);
}

@Override
public Student findStudentById(int sid) throws SQLException {

    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());
    return runner.query(&quot;select * from stu where sid = ?&quot;, new BeanHandler&lt;Student&gt;(Student.class) ,sid);
}

@Override
public void update(Student student) throws SQLException {
    // TODO Auto-generated method stub
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());

    runner.update(&quot;update stu set sname=? , gender=? , phone=? , birthday=? , hobby=? , info=? where sid = ?&quot;, 
            student.getSname(),
            student.getGender(),
            student.getPhone(),
            student.getBirthday(),
            student.getHobby(),
            student.getInfo(),
            student.getSid());
}

@Override
public List&lt;Student&gt; searchStudent(String sname, String sgender) throws SQLException {
    System.out.println(&quot;现在要执行模糊查询了，收到的name =&quot;+sname + &quot;==genser==&quot;+sgender);

    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());


    /*
     * 这里要分析一下：
     *     如果只有姓名 ，select * from stu where sname like ? ;
     *     如果只有性别 ， select * from stu where gender = ?
     * 
     * 如果两个都有 select * from stu where sname like ? and gender=?
     * 
     * 如果两个都没有就查询所有。
     * 
     */
    String sql = &quot;select * from stu where 1=1 &quot;;
    List&lt;String&gt; list = new ArrayList&lt;String&gt; ();

    //判断有没有姓名， 如果有，就组拼到sql语句里面，%是因为与like的固定搭配
    if(!TextUtils.isEmpty(sname)){
        sql = sql + &quot;  and sname like ?&quot;;
        list.add(&quot;%&quot;+sname+&quot;%&quot;);
    }

    //判断有没有性别，有的话，就组拼到sql语句里面。
    if(!TextUtils.isEmpty(sgender)){
        sql = sql + &quot; and gender = ?&quot;;
        list.add(sgender);
    }


    return runner.query(sql , new BeanListHandler&lt;Student&gt;(Student.class) ,list.toArray() );

}

@Override
public List&lt;Student&gt; findStudentByPage(int currentPage) throws SQLException {

    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());

    //5代表每页显示5条数据，跳过前面几页*5，就是当前页应该需要开始展示的数据
    return runner.query(&quot;select * from stu limit ? offset ?&quot;, new BeanListHandler&lt;Student&gt;(Student.class),5,(currentPage-1)*5);

}

@Override
public int findCount() throws SQLException {
    QueryRunner runner = new QueryRunner(new ComboPooledDataSource());
    //用于处理 平均值 、 总的个数。 
    Long  result = (Long) runner.query(&quot;SELECT COUNT(*) FROM stu&quot; , new ScalarHandler() );
    return result.intValue();
    }

}



import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.PageBean;
import com.feisheng.bean.Student;

public interface StudentService {

List&lt;Student&gt; findAll() throws SQLException ;
void insert(Student student)throws SQLException;

void delete(int sid) throws SQLException ;

Student findStudentById(int sid)throws SQLException ;

void update (Student student )throws SQLException ;

List&lt;Student&gt; searchStudent(String sname,String sgender) throws SQLException;



PageBean findStudentByPage(int currentPage) throws SQLException;

}




import java.sql.SQLException;
import java.util.List;
import com.feisheng.bean.PageBean;
import com.feisheng.bean.Student;
import com.feisheng.dao.StudentDao;
import com.feisheng.daoimple.StudentDaoImple;
import com.feisheng.service.StudentService;

public class StudentServiceImple implements StudentService{

@Override
public List&lt;Student&gt; findAll() throws SQLException {
    StudentDao dao = new StudentDaoImple();
    return dao.findAll();
}

@Override
public void insert(Student student) throws SQLException {
    StudentDao dao = new StudentDaoImple();
    dao.insert(student);
}

@Override
public void delete(int sid) throws SQLException {
    // TODO Auto-generated method stub

    StudentDao dao=new StudentDaoImple();
    dao.delete(sid);
}

@Override
public Student findStudentById(int sid) throws SQLException {

    StudentDao dao=new StudentDaoImple();
    return dao.findStudentById(sid);
}

@Override
public void update(Student student) throws SQLException {
    // TODO Auto-generated method stub
    StudentDao dao=new StudentDaoImple();
    dao.update(student);
}

@Override
public List&lt;Student&gt; searchStudent(String sname, String sgender) throws SQLException {

    StudentDao dao=new StudentDaoImple();
    return dao.searchStudent(sname, sgender);
}

@Override
public PageBean findStudentByPage(int currentPage) throws SQLException {

    //封装分页的该页数据
    PageBean&lt;Student&gt; pageBean = new PageBean&lt;Student&gt;();

    int pageSize = 5;
    pageBean.setCurrentPage(currentPage); //设置当前页
    pageBean.setPageSize(pageSize); //设置每页显示多少记录

    StudentDao dao = new StudentDaoImple() ;
    List&lt;Student&gt; list =dao .findStudentByPage(currentPage);
    pageBean.setList(list); //设置这一页的学生数据

    //总的记录数， 总的页数。
    int count = dao.findCount();
    pageBean.setTotalSize(count); //设置总的记录数
    //200 ， 10 ==20   201 ， 10 = 21   201 % 10 == 0 ?201 / 10 :201 % 10 + 1
    pageBean.setTotalPage(count % pageSize==0 ? count / pageSize : (count / pageSize) + 1); //总页数
    return pageBean;
            }    
    }
</code></pre><h3 id="开始可以写list-page-jsp了，显示"><a href="#开始可以写list-page-jsp了，显示" class="headerlink" title="开始可以写list_page.jsp了，显示"></a>开始可以写list_page.jsp了，显示</h3><pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;

 &lt;%@ taglib prefix=&quot;c&quot;  uri=&quot;http://java.sun.com/jsp/jstl/core&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;学生列表页面&lt;/title&gt;

&lt;script type=&quot;text/javascript&quot;&gt;

function doDelete(sid) {
    /* 如果这里弹出的对话框，用户点击的是确定，就马上去请求Servlet。 
    如何知道用户点击的是确定。
    如何在js的方法中请求servlet。 */
    var flag = confirm(&quot;是否确定删除?&quot;);
    if(flag){
        //表明点了确定。 访问servlet。 在当前标签页上打开 超链接，
        //window.location.href=&quot;DeleteServlet?sid=&quot;+sid;
        location.href=&quot;DeleteServlet?sid=&quot;+sid;
    }
}
&lt;/script&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;form action=&quot;SearchStudentServlet&quot; method=&quot;post&quot;&gt;
    &lt;table border=&quot;1&quot; width=&quot;700&quot;&gt;

        &lt;tr &gt;
            &lt;td colspan=&quot;8&quot;&gt;

                按姓名查询:&lt;input type=&quot;text&quot; name=&quot;sname&quot;/&gt;
                &amp;nbsp;
                按性别查询:&lt;select name=&quot;sgender&quot;&gt;
                            &lt;option value=&quot;&quot;&gt;--请选择--
                            &lt;option value=&quot;男&quot;&gt;男
                            &lt;option value=&quot;女&quot;&gt;女
                          &lt;/select&gt;
                &amp;nbsp;&amp;nbsp;&amp;nbsp;
                &lt;input type=&quot;submit&quot; value=&quot;查询&quot;&gt;
                &amp;nbsp;&amp;nbsp;&amp;nbsp;
                &lt;a href=&quot;add.jsp&quot;&gt;添加&lt;/a&gt;
            &lt;/td&gt;
        &lt;/tr&gt;

      &lt;tr align=&quot;center&quot;&gt;
        &lt;td&gt;编号&lt;/td&gt;
        &lt;td&gt;姓名&lt;/td&gt;
        &lt;td&gt;性别&lt;/td&gt;
        &lt;td&gt;电话&lt;/td&gt;
        &lt;td&gt;生日&lt;/td&gt;
        &lt;td&gt;爱好&lt;/td&gt;
        &lt;td&gt;简介&lt;/td&gt;
        &lt;td&gt;操作&lt;/td&gt;
      &lt;/tr&gt;

          &lt;c:forEach items=&quot;${pageBean.list }&quot; var=&quot;stu&quot;&gt;
              &lt;tr align=&quot;center&quot;&gt;
                &lt;td&gt;${stu.sid }&lt;/td&gt;
                &lt;td&gt;${stu.sname }&lt;/td&gt;
                &lt;td&gt;${stu.gender }&lt;/td&gt;
                &lt;td&gt;${stu.phone }&lt;/td&gt;
                &lt;td&gt;${stu.birthday }&lt;/td&gt;
                &lt;td&gt;${stu.hobby }&lt;/td&gt;
                &lt;td&gt;${stu.info }&lt;/td&gt;
                &lt;td&gt;&lt;a href=&quot;EditServlet?sid=${stu.sid }&quot;&gt;更新&lt;/a&gt;   &lt;a href=&quot;#&quot; onclick=&quot;doDelete(${stu.sid})&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;
              &lt;/tr&gt;
          &lt;/c:forEach&gt;

          &lt;tr&gt;
              &lt;td colspan=&quot;8&quot;&gt;
                  第 ${pageBean.currentPage } / ${pageBean.totalPage }
                  &amp;nbsp;&amp;nbsp;
                  每页显示${pageBean.pageSize }条  &amp;nbsp;&amp;nbsp;&amp;nbsp;
                  总的记录数${pageBean.totalSize } &amp;nbsp;&amp;nbsp;&amp;nbsp;
                  &lt;c:if test=&quot;${pageBean.currentPage !=1 }&quot;&gt;
                      &lt;a href=&quot;StudentListPageServlet?currentPage=1&quot;&gt;首页&lt;/a&gt;
                    | &lt;a href=&quot;StudentListPageServlet?currentPage=${pageBean.currentPage-1 }&quot;&gt;上一页&lt;/a&gt;
                  &lt;/c:if&gt;

                  &lt;c:forEach begin=&quot;1&quot; end=&quot;${pageBean.totalPage }&quot; var=&quot;i&quot;&gt;
                      &lt;c:if test=&quot;${pageBean.currentPage == i }&quot;&gt;
                          ${i }
                      &lt;/c:if&gt;
                      &lt;c:if test=&quot;${pageBean.currentPage != i }&quot;&gt;
                          &lt;a href=&quot;StudentListPageServlet?currentPage=${i }&quot;&gt;${i }&lt;/a&gt;
                      &lt;/c:if&gt;

                  &lt;/c:forEach&gt;


                  &lt;c:if test=&quot;${pageBean.currentPage !=pageBean.totalPage }&quot;&gt;
                      &lt;a href=&quot;StudentListPageServlet?currentPage=${pageBean.currentPage+1 }&quot;&gt;下一页&lt;/a&gt; | 
                      &lt;a href=&quot;StudentListPageServlet?currentPage=${pageBean.totalPage }&quot;&gt;尾页&lt;/a&gt;
                  &lt;/c:if&gt;
              &lt;/td&gt;
          &lt;/tr&gt;
      &lt;/table&gt;
  &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/17/事务+数据库连接池+DBUtils/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/17/事务+数据库连接池+DBUtils/" itemprop="url">后台08：事务+数据库连接池&DBUtils</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-17T00:00:00+08:00">
                2019-03-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>【事务Transaction】</p>
<p> <img src="/2019/03/17/事务+数据库连接池+DBUtils/img01.png" alt></p>
<p> <img src="/2019/03/17/事务+数据库连接池+DBUtils/img02.png" alt></p>
<blockquote>
<p>先关闭事务自动提交功能；</p>
</blockquote>
<blockquote>
<p>然后演示事务</p>
</blockquote>
<blockquote>
<p>开启事务：start transaction;</p>
</blockquote>
<blockquote>
<p>提交事务:commit;  //数据将会写到磁盘上的数据库</p>
</blockquote>
<blockquote>
<p>回滚事务:rollback  //数据回滚，回到最初的状态。</p>
</blockquote>
<blockquote>
<p>事务==一组逻辑操作的集合，这组逻辑操作都要成功，事务才能算完成，否则就是失败，再次回滚到初始状态；</p>
</blockquote>
<blockquote>
<p>为什么要有事务? 为了确保一整组逻辑操作全部成功，而不是个别成功。 例子： 银行的转账。 </p>
</blockquote>
<p><br></p>
<p>【银行转钱基本示例：改成事务】</p>
<pre><code>import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import org.junit.Test;

public class BankTest {

@Test
public void TransactionTest() {

        Connection conn=null;
        PreparedStatement ps=null;
        ResultSet res=null;

        try {
            //注册+连接+获取连接对象
             conn = JDBCUtil.getConn();

             //关闭事务的自动提交功能
            // conn.setAutoCommit(false);

             //事务逻辑操作一
            String sql=&quot;UPDATE account SET money=money-? WHERE id=?&quot;;
            ps=conn.prepareStatement(sql);
            ps.setInt(1,100);
            ps.setInt(2,1);
            ps.executeUpdate();

            String s=null;
            s.length();

            //事务逻辑操作二
            String sql2=&quot;UPDATE account SET money=money-? WHERE id=?&quot;;
            ps=conn.prepareStatement(sql2);
            ps.setInt(1,-100);
            ps.setInt(2,2);
            ps.executeUpdate();

            conn.commit();

        } catch (Exception e) {
            e.printStackTrace();
            try {
                conn.rollback();
            } catch (SQLException e1) {
                // TODO Auto-generated catch block
                e1.printStackTrace();
            }
        }finally {
            JDBCUtil.release(res, ps, conn);
                    }    
            }
    }
</code></pre><blockquote>
<p>事务默认自动提交，一个链接Conn就算一个事务，猜测自动提交是时刻提交，数据改变和提交是同时的</p>
</blockquote>
<blockquote>
<p>所以上面的代码：-100是成功的，但是+100失败</p>
</blockquote>
<blockquote>
<p>然后取消注释，设置成手动提交，代码只要执行到commit的时候数据才会改变，所以此时-100也不会发生</p>
</blockquote>
<blockquote>
<p>新建lib目录，与src同级；粘贴JDBC的驱动jar包，然后右键Build Path</p>
</blockquote>
<blockquote>
<p>粘贴工具类JDBCUtil.java和路径文件：pass.properties</p>
</blockquote>
<blockquote>
<p>本项目目录右键—&gt;Build Path—&gt;Add libraries–&gt;JUnit5—&gt;单元测试方法名上加@Test</p>
</blockquote>
<p><br></p>
<p>【事务的特性：ACID】</p>
<ul>
<li>原子性</li>
</ul>
<blockquote>
<p>指的是 事务中包含的逻辑，不可分割。 </p>
</blockquote>
<ul>
<li>一致性</li>
</ul>
<blockquote>
<p>指的是 事务执行前后。数据完整性</p>
</blockquote>
<ul>
<li>隔离性</li>
</ul>
<blockquote>
<p>指的是 事务在执行期间不应该受到其他事务的影响</p>
</blockquote>
<ul>
<li>持久性</li>
</ul>
<blockquote>
<p>指的是 事务执行成功，那么数据应该持久保存到磁盘上。</p>
</blockquote>
<p>【事务的安全隐患 】</p>
<blockquote>
<p>不考虑隔离级别设置，那么会出现以下问题。</p>
</blockquote>
<ul>
<li>读<blockquote>
<p>脏读 不可重读读  幻读.</p>
</blockquote>
</li>
</ul>
<pre><code>* 脏读

&gt; 一个事务读到另外一个事务还未提交的数据

* 不可重复读 

&gt; 一个事务读到了另外一个事务提交的数据 ，造成了前后两次查询结果不一致。
</code></pre><p><br></p>
<p>【读未提交】演示</p>
<ol>
<li><p>设置A窗口的隔离级别为 读未提交<br><img src="/2019/03/17/事务+数据库连接池+DBUtils/img03.png" alt></p>
</li>
<li><p>两个窗口都分别开启事务</p>
</li>
</ol>
<p><img src="/2019/03/17/事务+数据库连接池+DBUtils/img04.png" alt></p>
<ul>
<li>写</li>
</ul>
<blockquote>
<p>丢失更新</p>
</blockquote>
<p><br></p>
<p>【读已提交】演示 </p>
<ol>
<li>设置A窗口的隔离级别为 读已提交</li>
</ol>
<p><img src="/2019/03/17/事务+数据库连接池+DBUtils/img05.png" alt></p>
<ol start="2">
<li>A B 两个窗口都开启事务， 在B窗口执行更新操作。</li>
</ol>
<p><img src="/2019/03/17/事务+数据库连接池+DBUtils/img06.png" alt></p>
<ol start="3">
<li>在A窗口执行的查询结果不一致。 一次是在B窗口提交事务之前，一次是在B窗口提交事务之后。</li>
</ol>
<p><img src="/2019/03/17/事务+数据库连接池+DBUtils/img07.png" alt></p>
<blockquote>
<p>这个隔离级别能够屏蔽 脏读的现象， 但是引发了另一个问题  ，不可重复读。</p>
</blockquote>
<p><br></p>
<p>【可串行化】</p>
<blockquote>
<p>如果有一个连接的隔离级别设置为了串行化 ，那么谁先打开了事务， 谁就有了先执行的权利， 谁后打开事务，谁就只能得着，等前面的那个事务，提交或者回滚后，才能执行。  但是这种隔离级别一般比较少用。 容易造成性能上的问题。 效率比较低。</p>
</blockquote>
<ul>
<li>按效率划分，从高到低</li>
</ul>
<blockquote>
<p>读未提交  &gt; 读已提交  &gt; 可重复读  &gt; 可串行化</p>
</blockquote>
<ul>
<li>按拦截程度 ，从高到底</li>
</ul>
<blockquote>
<p>可串行化 &gt; 可重复读 &gt; 读已提交 &gt;  读未提交</p>
</blockquote>
<p>【事务总结】</p>
<ol>
<li><p>在代码里面会使用事务 </p>
<pre><code>conn.setAutoCommit(false);
</code></pre></li>
</ol>
<pre><code>conn.commit();

conn.rollback();
</code></pre><ol start="2">
<li><p>事务只是针对连接连接对象，如果再开一个连接对象，那么那是默认的提交。</p>
</li>
<li><p>事务是会自动提交的。 </p>
</li>
</ol>
<p>【安全隐患】</p>
<pre><code>读
    脏读
        一个事务读到了另一个事务未提交的数据
    不可重复读
        一个事务读到了另一个事务已提交的数据，造成前后两次查询结果不一致
    幻读
        一个事务读到了另一个事务insert的数据 ，造成前后查询结果不一致 。

写

    丢失更新。
</code></pre><p>【隔离级别】</p>
<p>读未提交</p>
<blockquote>
<p>引发问题： 脏读 </p>
</blockquote>
<p>读已提交</p>
<blockquote>
<p>解决： 脏读 ， 引发： 不可重复读</p>
</blockquote>
<p>可重复读</p>
<blockquote>
<p>解决： 脏读 、 不可重复读 ， 未解决： 幻读</p>
</blockquote>
<p>可串行化</p>
<blockquote>
<p>解决： 脏读、 不可重复读 、 幻读。</p>
</blockquote>
<p>mySql 默认的隔离级别是 可重复读</p>
<p>Oracle 默认的隔离级别是  读已提交</p>
<p>【丢失更新】</p>
<p><img src="/2019/03/17/事务+数据库连接池+DBUtils/img08.png" alt="icon"></p>
<p>【解决丢失更新】</p>
<ul>
<li>悲观锁</li>
</ul>
<blockquote>
<p>可以在查询的时候，加入 for update</p>
</blockquote>
<p><img src="/2019/03/17/事务+数据库连接池+DBUtils/img09.png" alt="icon"></p>
<ul>
<li>乐观锁</li>
</ul>
<blockquote>
<p>要求程序员自己控制。 </p>
</blockquote>
<p><img src="/2019/03/17/事务+数据库连接池+DBUtils/img10.png" alt="icon"></p>
<hr>
<p>【数据库连接池】—》数据库连接池==构造连接对象的集合，统一管理和循环使用连接对象，本质是集合！！！</p>
<p> <img src="/2019/03/17/事务+数据库连接池+DBUtils/13.png" alt></p>
<pre><code>import java.io.InputStream;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import java.util.Properties;
import javax.sql.DataSource;
import org.apache.commons.dbcp.BasicDataSource;
import org.apache.commons.dbcp.BasicDataSourceFactory;
import org.apache.commons.dbutils.QueryRunner;
import org.apache.commons.dbutils.ResultSetHandler;
import org.apache.commons.dbutils.handlers.BeanHandler;
import org.apache.commons.dbutils.handlers.BeanListHandler;
import org.junit.Test;
import com.mchange.v2.c3p0.ComboPooledDataSource;

public class TestC3P0Demo {

@Test
public void testCPDBU() throws SQLException {

    //C3P0创建数据库连接池
    ComboPooledDataSource dataSource = new ComboPooledDataSource();

    //DBUtils从连接池获取连接对象，然后进行CRUD
    QueryRunner queryRunner=new QueryRunner(dataSource);

    //增
    queryRunner.update(&quot;insert into account values(null,?,?)&quot;,&quot;迪丽热巴&quot;,888);
    //删
    queryRunner.update(&quot;delete from account where id=?&quot;,7);
    //改
    queryRunner.update(&quot;update account set money=? where id=?&quot;,999,4);
    //查一个：繁
    User user=queryRunner.query(&quot;select * from account where id = ?&quot;,new ResultSetHandler&lt;User&gt;() {

        @Override
        public User handle(ResultSet arg0) throws SQLException {
            //手动封装数据到Javabean返回
            User user=new User();
            while(arg0.next()) {

                String name=arg0.getString(&quot;name&quot;);
                int money=arg0.getInt(&quot;money&quot;);

                user.setName(name);
                user.setMoney(money);
            }
            return user;
        }


    },9);
    System.out.println(user.toString());


    //查一个
    User user2=queryRunner.query(&quot;select * from account where id = ?&quot;,new BeanHandler&lt;User&gt;(User.class),14);
    System.out.println(user2.toString());


    //查多个
    List&lt;User&gt; list=new ArrayList&lt;&gt;();
    list=queryRunner.query(&quot;select * from account&quot;,new BeanListHandler&lt;User&gt;(User.class));
    for(User users:list) {
        System.out.println(users.toString());
    }

}



//代码查询数据库
@Test
public void testC3P0(){
    Connection conn = null;
    PreparedStatement ps = null;
    try {

        //就new了一个对象。
        ComboPooledDataSource dataSource = new ComboPooledDataSource();

        //2. 得到连接对象
        conn = dataSource.getConnection();
        String sql = &quot;insert into account values(null , ? , ?)&quot;;
        ps = conn.prepareStatement(sql);
        ps.setString(1, &quot;wangwu2&quot;);
        ps.setInt(2, 2600);

        ps.executeUpdate();

    } catch (Exception e) {
        e.printStackTrace();
    }finally {
        JDBCUtil.release(ps, conn);
    }
}

//代码连接和查询数据库
@Test
public void testCP() {

    Connection conn = null;
    PreparedStatement ps = null;
    try {

        ComboPooledDataSource dataSource = new ComboPooledDataSource();
        System.out.println(dataSource.hashCode() );

        //2. 设置连接数据的信息
        dataSource.setDriverClass(&quot;com.mysql.cj.jdbc.Driver&quot;);

        //忘记了---&gt; 去以前的代码 ---&gt; jdbc的文档
        dataSource.setJdbcUrl(&quot;jdbc:mysql://localhost:3306/bank?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT&quot;);
        dataSource.setUser(&quot;root&quot;);
        dataSource.setPassword(&quot;8875696127m&quot;);

        //2. 得到连接对象
        conn = dataSource.getConnection();
        String sql = &quot;insert into account values(null , ? , ?)&quot;;
        ps = conn.prepareStatement(sql);
        ps.setString(1, &quot;hhhhhhhh&quot;);
        ps.setInt(2, 103200);

        ps.executeUpdate();

    } catch (Exception e) {
        e.printStackTrace();
    }finally {
        JDBCUtil.release(ps, conn);
    }
}

//文件配置DBCP
@Test
public void testUpdate() {

    Connection conn = null;
    PreparedStatement ps = null;
    try {
        BasicDataSourceFactory factory = new BasicDataSourceFactory();
        Properties properties = new Properties();

        //InputStream is = new FileInputStream(&quot;src//dbcpconfig.properties&quot;);
        InputStream is = getClass().getClassLoader().getResourceAsStream(&quot;dbcpconfig.properties&quot;);
        properties.load(is);
        DataSource dataSource = factory.createDataSource(properties);

        //2. 得到连接对象
        conn = dataSource.getConnection();
        String sql = &quot;insert into account values(null , ? , ?)&quot;;
        ps = conn.prepareStatement(sql);
        ps.setString(1, &quot;liangchaowei22&quot;);
        ps.setInt(2, 200);

        ps.executeUpdate();

    } catch (Exception e) {
        e.printStackTrace();
    }finally {
        JDBCUtil.release(ps, conn);
    }

}

@Test
public void testDBCP01(){


    Connection conn = null;
    PreparedStatement ps = null;
    try {

        //1. 构建数据源对象
        BasicDataSource dataSource = new BasicDataSource();
        //连的是什么类型的数据库， 访问的是哪个数据库 ， 用户名， 密码。。
        //jdbc:mysql://localhost/bank 主协议：子协议 ://本地/数据库
        dataSource.setDriverClassName(&quot;com.mysql.cj.jdbc.Driver&quot;);
        dataSource.setUrl(&quot;jdbc:mysql://localhost:3306/bank?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT&quot;);
        dataSource.setUsername(&quot;root&quot;);
        dataSource.setPassword(&quot;8875696127m&quot;);


        //2. 得到连接对象
        conn = dataSource.getConnection();
        String sql = &quot;insert into account values(null , ? , ?)&quot;;
        ps = conn.prepareStatement(sql);
        ps.setString(1, &quot;admin33333&quot;);
        ps.setInt(2, 1000);

        ps.executeUpdate();

    } catch (SQLException e) {
        e.printStackTrace();
    }finally {
        JDBCUtil.release(ps, conn);
    }

    }
    }
</code></pre><p>c3p0-config.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;c3p0-config&gt;

&lt;!-- default-config 默认的配置，  --&gt;
  &lt;default-config&gt;
&lt;property name=&quot;driverClass&quot;&gt;com.mysql.cj.jdbc.Driver&lt;/property&gt;
&lt;property name=&quot;jdbcUrl&quot;&gt;jdbc:mysql://localhost:3306/bank?useSSL=false&amp;amp;serverTimezone=Hongkong&amp;amp;characterEncoding=utf-8&amp;amp;autoReconnect=true&lt;/property&gt;
&lt;property name=&quot;user&quot;&gt;root&lt;/property&gt;
&lt;property name=&quot;password&quot;&gt;8875696127m&lt;/property&gt;


&lt;property name=&quot;initialPoolSize&quot;&gt;10&lt;/property&gt;
&lt;property name=&quot;maxIdleTime&quot;&gt;30&lt;/property&gt;
&lt;property name=&quot;maxPoolSize&quot;&gt;100&lt;/property&gt;
&lt;property name=&quot;minPoolSize&quot;&gt;10&lt;/property&gt;
&lt;property name=&quot;maxStatements&quot;&gt;200&lt;/property&gt;
  &lt;/default-config&gt;

&lt;/c3p0-config&gt;
</code></pre><p>User.java </p>
<pre><code>public class User {

private String name;
private int money;
public String getName() {
    return name;
}
public void setName(String name) {
    this.name = name;
}
public int getMoney() {
    return money;
}
public void setMoney(int money) {
    this.money = money;
}

@Override
public String toString() {
    return &quot;User [name=&quot; + name + &quot;, money=&quot; + money + &quot;]&quot;;
    }
}
</code></pre><blockquote>
<p>Getter和Setter可以快捷键    </p>
</blockquote>
<blockquote>
<p>以后做项目首选C3P0和DBUtils搭配，一个创建数据库连接池，一个获取连接对象直接进行CRUD</p>
</blockquote>
<blockquote>
<p>lib的jar包：c3p0包，dbutils包，mysql.jdbc包</p>
</blockquote>
<blockquote>
<p>src目录下的c3p0-config.xml文件，固定名称不可改，而且要根据版本号来改配置信息，这个Bug调试了一个下午,非常重要</p>
</blockquote>
<blockquote>
<ol>
<li>数据库的连接对象创建工作，比较消耗性能。 </li>
</ol>
</blockquote>
<blockquote>
<p>2.一开始现在内存中开辟一块空间（集合） ， 一开先往池子里面放置 多个连接对象。  后面需要连接的话，直接从池子里面去。不要去自己创建连接了。  使用完毕， 要记得归还连接。确保连接对象能循环利用。</p>
</blockquote>
<p><img src="/2019/03/17/事务+数据库连接池+DBUtils/img/img11.png" alt="icon"></p>
<p>【装饰者模式】</p>
<p>Waiter.java</p>
<pre><code>//父接口
public interface Waiter {

    void service();
}
</code></pre><p>A类：</p>
<pre><code>//实现父接口
public class Waitress implements Waiter {

@Override
public void service() {
    System.out.println(&quot;在服务...&quot;);
    }

}
</code></pre><p>B类：回调A类对象方法+附加操作，装饰A类的象方操作</p>
<pre><code>public class WaitressWrap implements Waiter {

Waiter watier  = null;
public WaitressWrap(Waiter watier){
    this.watier = watier;
}


@Override
public void service() {
    System.out.println(&quot;微笑:::&quot;);
    watier.service();
    }
}
</code></pre><p>使用Demo</p>
<pre><code>public class MainTest {

    public static void main(String[] args) {
        /*Waiter waiter = new Waitress();

    waiter.service();*/

    WaitressWrap waitressWrap = new WaitressWrap(new Waitress());

    waitressWrap.service();

    }
}
</code></pre><blockquote>
<p> 装饰者模式== A类构造器接收B类对象，回调B类象方来构造新的API—-》其实就是一个回调构造新的API</p>
</blockquote>
<blockquote>
<p>（跟普通回调不一样的== A类和B类的需要是同一父类）</p>
</blockquote>
<blockquote>
<p>面向接口的好处就是： 可以从大局出发，搭建好框架，提前写好必须要实现的空抽象方法名，然后可以不用看实现类具体实现，直接使用多态创建对象，接口引用直接调用方法即可！！！很方便！！！</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/16/JSP+JSTL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/16/JSP+JSTL/" itemprop="url">后台07：JSP&JSTL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-16T00:00:00+08:00">
                2019-03-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Java-Server-Page"><a href="#Java-Server-Page" class="headerlink" title="Java Server Page"></a>Java Server Page</h3><p>[什么是jsp]</p>
<blockquote>
<p><strong>jsp==html + java==翻译成一个Servlet类==html加上动态数据效果</strong></p>
</blockquote>
<p>[学生管理系统Demo]</p>
<p> <img src="/2019/03/16/JSP+JSTL/3.png" alt></p>
<p>[1.登录页面：login.jsp]</p>
<pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

  &lt;form action=&quot;LoginServlet&quot; method=&quot;post&quot;&gt;

账号：&lt;input type=&quot;text&quot; name=&quot;username&quot;/&gt; &lt;br &gt;
密码：&lt;input type=&quot;text&quot; name=&quot;password&quot;/&gt; &lt;br &gt;
  &lt;input type=&quot;submit&quot; value=&quot;Login&quot;/&gt; 

  &lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><blockquote>
<p>第一行记得改UTF-8，防止乱码</p>
</blockquote>
<blockquote>
<p>&lt;form 里面的&lt;input可以理解为表单输入控件</p>
</blockquote>
<blockquote>
<p>action属性代表点击submit后就会触发Post请求跳转到LoginServlet程序</p>
</blockquote>
<p>[2.LoginServlet.java]</p>
<pre><code>import java.io.IOException;
import java.util.List;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import com.qfs.dao.StudentDao;
import com.qfs.dao.imple.StudentDaoImple;
import com.qfs.dao.imple.UserDaoImple;
import domain.Student;

/**
     * 处理登录的Servlet
 */
public class LoginServlet extends HttpServlet {


protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    //解决中文乱码的问题
    request.setCharacterEncoding(&quot;UTF-8&quot;);
    response.setContentType(&quot;text/html;charset=UTF-8&quot;);

    //1.从request请求体获取参数值:即登录界面的用户信息
    String username = request.getParameter(&quot;username&quot;);
    String password = request.getParameter(&quot;password&quot;);

    //使用Dao来访问数据库，并返回查询结果
    boolean isSuccess=new UserDaoImple().login(username,password);

    //身份验证成功
    if(isSuccess) {

        //Dao取数据和传数据，作用域Session对象通用取数据
        StudentDao st=new StudentDaoImple();
        List&lt;Student&gt; list=st.findAll();
        System.out.println(&quot;&quot;+list.size());
        //session作用域来存值，其它地方通用取数据
        request.getSession().setAttribute(&quot;list&quot;, list);

        response.sendRedirect(&quot;Student.jsp&quot;);
    }else {
        response.getWriter().write(&quot;登录失败咯&quot;);
    }
}

protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // TODO Auto-generated method stub
    doGet(request, response);
            }

    }
</code></pre><blockquote>
<p>解决中文乱码</p>
</blockquote>
<blockquote>
<p>获取login.jsp表单控件的数据，用Dao来访问数据库进行身份验证</p>
</blockquote>
<blockquote>
<p>验证成功，用Dao来访问学生数据库的表的数据，数据存储在对象中，对象存储在集合中</p>
</blockquote>
<blockquote>
<p>在把学生数据存储到同用作用域Session中</p>
</blockquote>
<blockquote>
<p>跳转到下一个页面显示学生数据：Student.jsp(通过作用域Session获取数据)</p>
</blockquote>
<p>[3.User.Dao]</p>
<pre><code>public interface UserDao {

    //用户登录时访问用户数据库数据，返回查询结果
    boolean login(String username,String password);
}
</code></pre><p>[4.UserDaoImple]</p>
<pre><code>import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import com.qfs.dao.UserDao;
import com.qfs.util.JDBCUtil;

public class UserDaoImple implements UserDao {

private Connection conn;
private PreparedStatement ps;
private ResultSet res;

@Override
public boolean login(String username,String password) {

    try {
    //连接数据库
     conn = JDBCUtil.getConn();


    //准备查询数据库
    String sql=&quot;SELECT * FROM t_user WHERE username=? AND password=?&quot;;
    ps = conn.prepareStatement(sql);
    ps.setString(1,username);
    ps.setString(2,password);


    //开始查询数据库
   res = ps.executeQuery();

   //返回查询结果
    return res.next();


    } catch (SQLException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }finally {
        JDBCUtil.release(res, ps, conn);
    }

    return false;
    }    
}
</code></pre><blockquote>
<p>需要导入数据库工具类JDBCUtil.java</p>
</blockquote>
<p>[5.JDBCUtil.java]</p>
<pre><code>import java.io.InputStream;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Properties;

public class JDBCUtil {

//读取xxx.properties文件来填充
static String driverClass = null;
static String url = null;
static String user = null;
static String password= null;
static{
    try {
        //1. 创建一个属性配置对象
        Properties properties = new Properties();
        //使用类加载器，去读取src底下的资源文件。 后面在servlet
        InputStream is = JDBCUtil.class.getClassLoader().getResourceAsStream(&quot;pass.properties&quot;);
        //导入输入流。
        properties.load(is);

        //读取属性
        driverClass = properties.getProperty(&quot;driverClass&quot;);
        url = properties.getProperty(&quot;url&quot;);
        user = properties.getProperty(&quot;user&quot;);
        password = properties.getProperty(&quot;password&quot;);

    } catch (Exception e) {
        e.printStackTrace();
    }
}



/**
 * 获取连接对象
 * @return
 */
public static Connection getConn(){
    Connection conn = null;
    try {

        //静态代码块 ---&gt; 类加载了，就执行。 java.sql.DriverManager.registerDriver(new Driver());
        Class.forName(driverClass);

        conn = DriverManager.getConnection(url, user, password);

    } catch (Exception e) {
        e.printStackTrace();
    }
    return conn;
}


public static void release(ResultSet res,Statement state,Connection conn) {

    closeRes(res);
    closeState(state);
    closeConnection(conn);
}

public static void release(Statement state,Connection conn) {

    closeState(state);
    closeConnection(conn);
}

private static void closeRes(ResultSet res) {

    try {
        if(res!=null) {
            res.close();
        }

    } catch (SQLException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }finally {
        res=null;
    }
}


private static void closeState(Statement state) {

    try {
        if(state!=null) {
            state.close();
        }

    } catch (SQLException e) {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }finally {
        state=null;
    }
}


private static void closeConnection(Connection conn) {

try {
    if(conn!=null) {
        conn.close();
    }

} catch (SQLException e) {
    // TODO Auto-generated catch block
    e.printStackTrace();
}finally {
    conn=null;
        }
            }    
    }
</code></pre><blockquote>
<p>粘贴JDBC的驱动文件</p>
</blockquote>
<p>[6.pass.properties文件]</p>
<pre><code>driverClass=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/stums?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT
user=root
password=8875696127m
</code></pre><blockquote>
<p>粘贴在Src目录下，stums是要访问的数据库名称，改这里就可以了</p>
</blockquote>
<p>[7.StudentDao]</p>
<pre><code>import java.util.List;
import domain.Student;

public interface StudentDao {

    List&lt;Student&gt; findAll();
}
</code></pre><blockquote>
<p>查询数据库的学生数据</p>
</blockquote>
<p>[8.StudentDaoImple.java]</p>
<pre><code>import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;
import com.qfs.dao.StudentDao;
import com.qfs.util.JDBCUtil;
import domain.Student;

public class StudentDaoImple implements StudentDao {

private Connection conn;
private PreparedStatement ps;
private ResultSet res;
List&lt;Student&gt; list;
@Override
public List&lt;Student&gt; findAll() {

    try {
        //连接数据库
         conn = JDBCUtil.getConn();


        //准备查询数据库
        String sql=&quot;SELECT * FROM t_student&quot;;
        ps = conn.prepareStatement(sql);

        //开始查询数据库,并返回结果
       res = ps.executeQuery();
       list=new ArrayList&lt;&gt;();
       while(res.next()) {

           Student student=new Student();
           student.setId(res.getInt(&quot;id&quot;));
           student.setName(res.getString(&quot;name&quot;));
           student.setAge(res.getInt(&quot;age&quot;));
           student.setGender(res.getString(&quot;gender&quot;));
           student.setAddress(res.getString(&quot;address&quot;));
           list.add(student);

       }


        } catch (SQLException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }finally {
            JDBCUtil.release(res, ps, conn);
        }
    return list;
        }

}
</code></pre><p>[9.bean: Student.java]</p>
<pre><code>public class Student {

  private int id;
  private String name;
  private int age;
  private String gender;
  private String address;


public int getId() {
    return id;
}
public void setId(int id) {
    this.id = id;
}
public String getName() {
    return name;
}
public void setName(String name) {
    this.name = name;
}
public int getAge() {
    return age;
}
public void setAge(int age) {
    this.age = age;
}
public String getGender() {
    return gender;
}
public void setGender(String gender) {
    this.gender = gender;
}
public String getAddress() {
    return address;
}
public void setAddress(String address) {
    this.address = address;
}

}
</code></pre><blockquote>
<p>数据多了就存储在对象，对象多了就存储在集合；请求数据，返回数据，解析数据，填充显示view</p>
</blockquote>
<p>[10.Student.jsp]</p>
<pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;

&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot;%&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;学生管理系统&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;table border=&quot;1&quot; width=&quot;800&quot;&gt;


  &lt;tr align=&quot;center&quot;&gt;

    &lt;td&gt;编号&lt;/td&gt;
    &lt;td&gt;姓名&lt;/td&gt;
    &lt;td&gt;年龄&lt;/td&gt;
    &lt;td&gt;性别&lt;/td&gt;
    &lt;td&gt;住址&lt;/td&gt;
    &lt;td&gt;操作&lt;/td&gt;
  &lt;/tr&gt;


&lt;c:forEach items=&quot;${list}&quot; var=&quot;stu&quot;&gt;

&lt;tr align=&quot;center&quot;&gt;

    &lt;td&gt;${stu.id}&lt;/td&gt;
    &lt;td&gt;${stu.name}&lt;/td&gt;
    &lt;td&gt;${stu.age}&lt;/td&gt;
    &lt;td&gt;${stu.gender}&lt;/td&gt;
    &lt;td&gt;${stu.address}&lt;/td&gt;
     &lt;td&gt;&lt;a href=&quot;#&quot;&gt;更新&lt;/a&gt;&lt;a href=&quot;#&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;
  &lt;/tr&gt;


&lt;/c:forEach&gt;

&lt;/table&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><blockquote>
<p>导入JSTL的两个标签库： jstl.jar和standard.jar</p>
</blockquote>
<p> <img src="/2019/03/16/JSP+JSTL/4.gif" alt></p>
<hr>
<p>[什么是jsp]</p>
<blockquote>
<p><strong>jsp==html + java==翻译成一个Servlet类==html加上动态数据效果</strong></p>
</blockquote>
<blockquote>
<p>从用户角度看待 ，就是是一个网页 ， 从程序员角度看待 ， 其实是一个java类， 它继承了servlet，所以可以直接说jsp 就是一个Servlet.</p>
</blockquote>
<p>[为什么会有jsp]</p>
<blockquote>
<p>html 多数情况下用来显示静态内容 ， 一成不变的。 但是有时候我们需要在网页上显示一些动态数据， 比如： 查询所有的学生信息， 根据姓名去查询具体某个学生。  这些动作都需要去查询数据库，然后在网页上显示。 html是不支持写java代码  ， jsp里面可以写java代码。</p>
</blockquote>
<p><strong>[JSP的三大指令：page指令]</strong></p>
<pre><code>&lt;%@ page language=&quot;java&quot; 
contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;
</code></pre><blockquote>
<p>属性language: 表明jsp页面中可以写java代码</p>
</blockquote>
<blockquote>
<p>属性contentType: 其实即使说这个文件是什么类型，告诉浏览器我是什么内容类型，以及使用什么编码</p>
</blockquote>
<blockquote>
<p>属性contentType=”text/html; charset=UTF-8”</p>
</blockquote>
<blockquote>
<p>属性text/html  MIMEType 这是一个文本，html网页</p>
</blockquote>
<blockquote>
<p>属性pageEncoding,jsp的内容编码格式</p>
</blockquote>
<blockquote>
<p>属性extends 用于指定jsp翻译成java文件后，继承的父类是谁，一般不用改。</p>
</blockquote>
<blockquote>
<p>属性import 导包使用的，一般不用手写。</p>
</blockquote>
<blockquote>
<p>属性session </p>
</blockquote>
<blockquote>
<p>值可选的有true or false .</p>
</blockquote>
<blockquote>
<p>用于控制在这个jsp页面里面，能够直接使用session对象。</p>
</blockquote>
<blockquote>
<p>具体的区别是，请看翻译后的java文件   如果该值是true , 那么在代码里面会有getSession（）的调用，如果是false :  那么就不会有该方法调用，也就是没有session对象了。在页面上自然也就不能使用session了。</p>
</blockquote>
<blockquote>
<p>属性errorPage指的是错误的页面， 值需要给错误的页面路径</p>
</blockquote>
<blockquote>
<p>属性isErrorPage上面的errorPage 用于指定错误的时候跑到哪一个页面去。 那么这个isErroPage , 就是声明某一个页面到底是不是错误的页面。</p>
</blockquote>
<p><strong>[JSP的三大指令：include指令]</strong></p>
<blockquote>
<p>包含另外一个jsp的文件内容进来。</p>
</blockquote>
<blockquote>
<p>&lt;%@ include file=”other02.jsp”%&gt;</p>
</blockquote>
<blockquote>
<p>背后细节: 把另外一个页面的所有内容拿过来一起输出。 所有的标签元素都包含进来。</p>
</blockquote>
<p><strong>[JSP的三大指令：taglib指令]</strong></p>
<blockquote>
<p>&lt;%@ taglib prefix=””  uri=””%&gt;  </p>
</blockquote>
<blockquote>
<p>uri: 标签库路径</p>
</blockquote>
<blockquote>
<p>prefix : 标签库的别名  </p>
</blockquote>
<p>[JSP的动作标签]</p>
<p> <img src="/2019/03/16/JSP+JSTL/1.png" alt></p>
<pre><code>&lt;jsp:include page=&quot;&quot;&gt;&lt;/jsp:include&gt;
&lt;jsp:param value=&quot;&quot; name=&quot;&quot;/&gt;
&lt;jsp:forward page=&quot;&quot;&gt;&lt;/jsp:forward&gt;
</code></pre><p>[jsp:include]</p>
<blockquote>
<p>&lt;jsp:include page=”other02.jsp”&gt;&lt;/jsp:include&gt;</p>
</blockquote>
<blockquote>
<p>包含指定的页面， 这里是动态包含。 也就是不把包含的页面所有元素标签全部拿过来输出，而是把它的运行结果拿过来。 </p>
</blockquote>
<p>[jsp:forward]</p>
<blockquote>
<p>&lt;jsp:forward page=””&gt;&lt;/jsp:forward&gt;</p>
</blockquote>
<blockquote>
<p>前往哪一个页面。  </p>
</blockquote>
<blockquote>
<p>&lt;%<br>        //请求转发<br>        request.getRequestDispatcher(“other02.jsp”).forward(request, response);<br>    %&gt;    </p>
</blockquote>
<p>[jsp:param]</p>
<blockquote>
<p>意思是： 在包含某个页面的时候，或者在跳转某个页面的时候，加入这个参数。</p>
</blockquote>
<pre><code>&lt;jsp:forward page=&quot;other02.jsp&quot;&gt;
    &lt;jsp:param value=&quot;beijing&quot; name=&quot;address&quot;/&gt;
&lt;/jsp:forward&gt;

//到另外一个页面收参数
在other02.jsp中获取参数

&lt;br&gt;收到的参数是：&lt;br&gt;

&lt;%= request.getParameter(&quot;address&quot;)%&gt;
</code></pre><p>[JSP9大内置对象，四大作用域：使用范围]</p>
<pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

使用作用域来存储数据&lt;br&gt;

    &lt;%
        pageContext.setAttribute(&quot;name&quot;, &quot;page&quot;);
        request.setAttribute(&quot;name&quot;, &quot;request&quot;);
        session.setAttribute(&quot;name&quot;, &quot;session&quot;);
        application.setAttribute(&quot;name&quot;, &quot;application&quot;);
    %&gt;

    取出四个作用域中的值&lt;br&gt;

    &lt;%=pageContext.getAttribute(&quot;name&quot;)%&gt;
    &lt;%=request.getAttribute(&quot;name&quot;)%&gt;
    &lt;%=session.getAttribute(&quot;name&quot;)%&gt;
    &lt;%=application.getAttribute(&quot;name&quot;)%&gt;

&lt;%
//请求转发
   request.getRequestDispatcher(&quot;other04.jsp&quot;).forward(request,response);
%&gt;

&lt;%
  //重定向。与上面二选一
  response.sendRedirect(&quot;other04.jsp&quot;);
%&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><blockquote>
<p>所谓内置对象，就是我们可以直接在jsp页面中使用这些对象。 不用创建。</p>
</blockquote>
<ul>
<li>pageContext</li>
<li>request</li>
<li>session</li>
<li>application</li>
</ul>
<p>以上4个是作用域对象 , </p>
<ul>
<li>作用域 </li>
</ul>
<blockquote>
<p>表示这些对象可以存值，他们的取值范围有限定。  setAttribute   和  getAttribute</p>
</blockquote>
<pre><code>使用作用域来存储数据&lt;br&gt;

&lt;%
    pageContext.setAttribute(&quot;name&quot;, &quot;page&quot;);
    request.setAttribute(&quot;name&quot;, &quot;request&quot;);
    session.setAttribute(&quot;name&quot;, &quot;session&quot;);
    application.setAttribute(&quot;name&quot;, &quot;application&quot;);
%&gt;

取出四个作用域中的值&lt;br&gt;

&lt;%=pageContext.getAttribute(&quot;name&quot;)%&gt;
&lt;%=request.getAttribute(&quot;name&quot;)%&gt;
&lt;%=session.getAttribute(&quot;name&quot;)%&gt;
&lt;%=application.getAttribute(&quot;name&quot;)%&gt;
</code></pre><p>作用域范围大小：</p>
<pre><code>pageContext -- request --- session -- application 
</code></pre><p>[四个作用域的区别]</p>
<ul>
<li>pageContext 【PageContext】</li>
</ul>
<blockquote>
<p>作用域仅限于当前的页面。  </p>
</blockquote>
<blockquote>
<p>还可以获取到其他八个内置对象。</p>
</blockquote>
<ul>
<li>request 【HttpServletRequest】</li>
</ul>
<blockquote>
<p>作用域仅限于一次请求， 只要服务器对该请求做出了响应。 这个域中存的值就没有了。</p>
</blockquote>
<ul>
<li>session 【HttpSession】</li>
</ul>
<blockquote>
<p>作用域限于一次会话（多次请求与响应） 当中。 </p>
</blockquote>
<ul>
<li>application 【ServletContext】</li>
</ul>
<blockquote>
<p>整个工程都可以访问， 服务器关闭后就不能访问了。 </p>
</blockquote>
<ul>
<li><p>out         【JspWriter】</p>
<ul>
<li>response  【HttpServletResponse】</li>
</ul>
<p><img src="/2019/03/16/JSP+JSTL/2.png" alt></p>
</li>
</ul>
<ul>
<li>exception  【Throwable】<ul>
<li>page     【Object】 —就是这个jsp翻译成的java类的实例对象<ul>
<li>config 【ServletConfig】</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>##EL表达式</p>
<blockquote>
<p>是为了简化咱们的jsp代码，具体一点就是为了简化在jsp里面写的那些java代码。</p>
</blockquote>
<ul>
<li>写法格式</li>
</ul>
<p>${表达式 }</p>
<blockquote>
<p>如果从作用域中取值，会先从小的作用域开始取，如果没有，就往下一个作用域取。  一直把四个作用域取完都没有， 就没有显示。</p>
</blockquote>
<p>###如何使用</p>
<p>###1. 取出4个作用域中存放的值。</p>
<pre><code>&lt;%
    pageContext.setAttribute(&quot;name&quot;, &quot;page&quot;);
    request.setAttribute(&quot;name&quot;, &quot;request&quot;);
    session.setAttribute(&quot;name&quot;, &quot;session&quot;);
    application.setAttribute(&quot;name&quot;, &quot;application&quot;);
%&gt;

按普通手段取值&lt;br&gt;

&lt;%= pageContext.getAttribute(&quot;name&quot;)%&gt;
&lt;%= request.getAttribute(&quot;name&quot;)%&gt;
&lt;%= session.getAttribute(&quot;name&quot;)%&gt;
&lt;%= application.getAttribute(&quot;name&quot;)%&gt;

&lt;br&gt;使用EL表达式取出作用域中的值&lt;br&gt;

${ pageScope.name }
${ requestScope.name }
${ sessionScope.name }
${ applicationScope.name }
</code></pre><ol start="2">
<li><p>如果域中所存的是数组</p>
<pre><code>&lt;%
    String [] a = {&quot;aa&quot;,&quot;bb&quot;,&quot;cc&quot;,&quot;dd&quot;};
    pageContext.setAttribute(&quot;array&quot;, a);
%&gt;

使用EL表达式取出作用域中数组的值&lt;br&gt;

${array[0] } , ${array[1] },${array[2] },${array[3] }
</code></pre></li>
</ol>
<ol start="3">
<li>如果域中锁存的是集合</li>
</ol>
<pre><code>使用EL表达式取出作用域中集合的值&lt;br&gt;

${li[0] } , ${li[1] },${li[2] },${li[3] }

&lt;br&gt;-------------Map数据----------------&lt;br&gt;
&lt;%
    Map map = new HashMap();
    map.put(&quot;name&quot;, &quot;zhangsna&quot;);
    map.put(&quot;age&quot;,18);
    map.put(&quot;address&quot;,&quot;北京..&quot;);

    map.put(&quot;address.aa&quot;,&quot;深圳..&quot;);


    pageContext.setAttribute(&quot;map&quot;, map);
%&gt;
</code></pre><ol start="4">
<li><p>取出Map集合的值</p>
<pre><code>&lt;%
    Map map = new HashMap();
    map.put(&quot;name&quot;, &quot;zhangsna&quot;);
    map.put(&quot;age&quot;,18);
    map.put(&quot;address&quot;,&quot;北京..&quot;);

    map.put(&quot;address.aa&quot;,&quot;深圳..&quot;);
</code></pre></li>
</ol>
<pre><code>    pageContext.setAttribute(&quot;map&quot;, map);
%&gt;
使用EL表达式取出作用域中Map的值&lt;br&gt;

${map.name } , ${map.age } , ${map.address }  , ${map[&quot;address.aa&quot;] }
</code></pre><p>###取值细节：</p>
<ol>
<li><p>从域中取值。  得先存值。<br>&lt;%</p>
<pre><code>//pageContext.setAttribute(&quot;name&quot;, &quot;zhangsan&quot;);
session.setAttribute(&quot;name&quot;, &quot;lisi...&quot;);
</code></pre><p>%&gt;</p>
<p><br>直接指定说了，到这个作用域里面去找这个name<br><br>${ pageScope.name } </p>
</li>
</ol>
<p>   <br>//先从page里面找，没有去request找，去session，去application <br><br>   ${ name }</p>
<p>   <br>指定从session中取值<br><br>   ${ sessionScope.name }  </p>
<ol start="2">
<li>取值方式</li>
</ol>
<p>如果这份值是有下标的，那么直接使用[]</p>
<pre><code>&lt;%
    String [] array = {&quot;aa&quot;,&quot;bb&quot;,&quot;cc&quot;}
    session.setAttribute(&quot;array&quot;,array);
%&gt;


${ array[1] } --&gt; 这里array说的是attribute的name 
</code></pre><p>如果没有下标， 直接使用 .的方式去取</p>
<pre><code>&lt;%
    User user = new User(&quot;zhangsan&quot;,18);

    session.setAttribute(&quot;u&quot;, user);
%&gt;

${ u.name }  , ${ u.age } 
</code></pre><blockquote>
<p>一般使用EL表达式，用的比较多的，都是从一个对象中取出它的属性值，比如取出某一个学生的姓名。</p>
</blockquote>
<p>##EL表达式 的11个内置对象。 </p>
<p>${ 对象名.成员 }</p>
<ul>
<li>pageContext </li>
</ul>
<p>作用域相关对象</p>
<ul>
<li>pageScope</li>
<li>requestScope</li>
<li>sessionScope</li>
<li>applicationScope</li>
</ul>
<p>头信息相关对象</p>
<ul>
<li>header</li>
<li>headerValues</li>
</ul>
<p>参数信息相关对象</p>
<ul>
<li>param</li>
<li>paramValues</li>
</ul>
<ul>
<li>cookie<br>全局初始化参数</li>
<li>initParam</li>
</ul>
<p>##JSTL</p>
<blockquote>
<p>全称 ： JSP Standard Tag Library  jsp标准标签库</p>
</blockquote>
<blockquote>
<p>简化jsp的代码编写。 替换 &lt;%%&gt; 写法。 一般与EL表达式配合</p>
</blockquote>
<p>###怎么使用</p>
<ol>
<li><p>导入jar文件到工程的WebContent/Web-Inf/lib  jstl.jar standard.jar</p>
</li>
<li><p>在jsp页面上，使用taglib 指令，来引入标签库</p>
</li>
<li><p>注意： 如果想支持 EL表达式，那么引入的标签库必须选择1.1的版本，1.0的版本不支持EL表达式。</p>
</li>
</ol>
<pre><code>&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
</code></pre><p>###常用标签</p>
<p>&lt;c:set&gt;&lt;/c:set&gt;<br>&lt;c:if test=””&gt;&lt;/c:if&gt;<br>&lt;c:forEach&gt;&lt;/c:forEach&gt;</p>
<ul>
<li>c:set</li>
</ul>
<pre><code>&lt;!-- 声明一个对象name， 对象的值 zhangsan , 存储到了page（默认） ， 指定是session --&gt;
&lt;c:set var=&quot;name&quot; value=&quot;zhangsan&quot; scope=&quot;session&quot;&gt;&lt;/c:set&gt;

${sessionScope.name }
</code></pre><ul>
<li>c:if</li>
</ul>
<blockquote>
<p>判断test里面的表达式是否满足，如果满足，就执行c:if标签中的输出 ， c:if 是没有else的。 </p>
</blockquote>
<pre><code>&lt;c:set var=&quot;age&quot; value=&quot;18&quot; &gt;&lt;/c:set&gt;
&lt;c:if test=&quot;${ age &gt; 26 }&quot;&gt;
    年龄大于了26岁...
&lt;/c:if&gt;

&lt;c:if test=&quot;${ age &lt;= 26 }&quot;&gt;
    年龄小于了26岁...
&lt;/c:if&gt;


------------------------------

定义一个变量名 flag  去接收前面表达式的值，然后存在session域中

&lt;c:if test=&quot;${ age &gt; 26 }&quot; var=&quot;flag&quot; scope=&quot;session&quot;&gt;
    年龄大于了26岁...
&lt;/c:if&gt;
</code></pre><ul>
<li>c:forEach</li>
</ul>
<pre><code>从1 开始遍历到10 ，得到的结果 ，赋值给 i ,并且会存储到page域中， step , 增幅为2， 
&lt;c:forEach begin=&quot;1&quot; end=&quot;10&quot; var=&quot;i&quot; step=&quot;2&quot;&gt;
    ${i }
&lt;/c:forEach&gt;


-----------------------------------------------

&lt;!-- items : 表示遍历哪一个对象，注意，这里必须写EL表达式。 
var: 遍历出来的每一个元素用user 去接收。 --&gt;
&lt;c:forEach var=&quot;user&quot; items=&quot;${list }&quot;&gt;
    ${user.name } ----${user.age }
&lt;/c:forEach&gt;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/15/Cookie+Session/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="QiuFeisheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QiuFeisheng'Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/15/Cookie+Session/" itemprop="url">后台06：Cookie&Session</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-03-15T00:00:00+08:00">
                2019-03-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="解决GET请求下载文件资源时的文件名为中文的问题"><a href="#解决GET请求下载文件资源时的文件名为中文的问题" class="headerlink" title="解决GET请求下载文件资源时的文件名为中文的问题"></a>解决GET请求下载文件资源时的文件名为中文的问题</h3><blockquote>
<p>针对浏览器类型，对文件名字做编码处理 Firefox (Base64) , IE、Chrome … 使用的是URLEncoder</p>
</blockquote>
<pre><code>/*
 * 如果文件的名字带有中文，那么需要对这个文件名进行编码处理
 * 如果是IE ，或者  Chrome （谷歌浏览器） ，使用URLEncoding 编码
 * 如果是Firefox ， 使用Base64编码
 */
//获取来访的客户端类型
String clientType = request.getHeader(&quot;User-Agent&quot;);

if(clientType.contains(&quot;Firefox&quot;)){
    fileName = DownLoadUtil.base64EncodeFileName(fileName);
}else{
    //IE ，或者  Chrome （谷歌浏览器） ，
    //对中文的名字进行编码处理
    fileName = URLEncoder.encode(fileName,&quot;UTF-8&quot;);
}
</code></pre><h3 id="Servlet的html跳转：重定向或者请求转发来实现"><a href="#Servlet的html跳转：重定向或者请求转发来实现" class="headerlink" title="Servlet的html跳转：重定向或者请求转发来实现"></a>Servlet的html跳转：重定向或者请求转发来实现</h3><p> <img src="/2019/03/15/Cookie+Session/1.png" alt></p>
<p>[普通早期写法]：</p>
<blockquote>
<p>response.setStatus(302);</p>
</blockquote>
<blockquote>
<p>response.setHeader(“Location”,”login_success.html”);</p>
</blockquote>
<pre><code>import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;


public class LoginServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

   //request.setCharacterEncoding(&quot;UTF-8&quot;);

    //1.获取客户端提交的数据
    String username=request.getParameter(&quot;username&quot;);
    String password=request.getParameter(&quot;password&quot;);

    //get请求过来的数据，在url地址栏上就已经经过编码了，所以我们取到的就是乱码，
    //tomcat收到了这批数据，getParameter 默认使用ISO-8859-1去解码
    //先让文字回到ISO-8859-1对应的字节数组 ， 然后再按utf-8组拼字符串
    username = new String(username.getBytes(&quot;ISO-8859-1&quot;) , &quot;UTF-8&quot;);
    System.out.println(&quot;userName=&quot;+username+&quot;==password=&quot;+password);


    //输出响应
    System.out.println(&quot;username==&quot;+username+&quot;  &quot;+&quot;password==&quot;+password);
    PrintWriter pw=response.getWriter();

    //构造ServletContext对象来存取登录次数，从而让登录成功页面的Servlet共享数据
    Object obj=getServletContext().getAttribute(&quot;count&quot;);
    int totalNumber=0;
    if(obj!=null) {
        totalNumber=(int)obj;
    }
    getServletContext().setAttribute(&quot;count&quot;, totalNumber+1);

    //html跳转
    if(&quot;admin&quot;.equals(username)&amp;&amp;&quot;123&quot;.equals(password)) {

        //设置状态码302可以重定位网页资源
        response.setStatus(302);
        response.setHeader(&quot;Location&quot;,&quot;login_success.html&quot;);
    }else {

        //登录失败就直接在Servlet的页面输出响应，上面是跳转到别的html页面
        pw.write(&quot;login failed&quot;);
        }
    }

protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
            }
    }
</code></pre><p>[重定向写法]</p>
<blockquote>
<p>response.sendRedirect(“login_success.html”);</p>
</blockquote>
<pre><code>import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class LoginServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

   //request.setCharacterEncoding(&quot;UTF-8&quot;);

    //1.获取客户端提交的数据
    String username=request.getParameter(&quot;username&quot;);
    String password=request.getParameter(&quot;password&quot;);

    //get请求过来的数据，在url地址栏上就已经经过编码了，所以我们取到的就是乱码，
    //tomcat收到了这批数据，getParameter 默认使用ISO-8859-1去解码
    //先让文字回到ISO-8859-1对应的字节数组 ， 然后再按utf-8组拼字符串
    username = new String(username.getBytes(&quot;ISO-8859-1&quot;) , &quot;UTF-8&quot;);
    System.out.println(&quot;userName=&quot;+username+&quot;==password=&quot;+password);


    //输出响应
    System.out.println(&quot;username==&quot;+username+&quot;  &quot;+&quot;password==&quot;+password);
    PrintWriter pw=response.getWriter();

    //构造ServletContext对象来存取登录次数，从而让登录成功页面的Servlet共享数据
    Object obj=getServletContext().getAttribute(&quot;count&quot;);
    int totalNumber=0;
    if(obj!=null) {
        totalNumber=(int)obj;
    }
    getServletContext().setAttribute(&quot;count&quot;, totalNumber+1);



    //html跳转
    if(&quot;admin&quot;.equals(username)&amp;&amp;&quot;123&quot;.equals(password)) {

        //重定向写法
        response.sendRedirect(&quot;login_success.html&quot;);
    }else {

        //登录失败就直接在Servlet的页面输出响应，上面是跳转到别的html页面
        pw.write(&quot;login failed&quot;);
    }
}

protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
        }

}
</code></pre><blockquote>
<ol>
<li>地址上显示的是最后的那个资源的路径地址</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>请求次数最少有两次， 服务器在第一次请求后，会返回302 以及一个地址， 浏览器在根据这个地址，执行第二次访问。</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>可以跳转到任意路径。 不是自己的工程也可以跳。</li>
</ol>
</blockquote>
<blockquote>
<ol start="4">
<li>效率稍微低一点， 执行两次请求。 </li>
</ol>
</blockquote>
<blockquote>
<ol start="5">
<li>后续的请求，没法使用上一次的request存储的数据，或者 没法使用上一次的request对象，因为这是两次不同的请求。</li>
</ol>
</blockquote>
<p>[请求转发写法]</p>
<blockquote>
<p>request.getRequestDispatcher(“login_success.html”).forward(request, response);</p>
</blockquote>
<pre><code>import java.io.IOException;
import java.io.PrintWriter;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class LoginServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    request.setCharacterEncoding(&quot;UTF-8&quot;);

    //1.获取客户端提交的数据
    String username=request.getParameter(&quot;username&quot;);
    String password=request.getParameter(&quot;password&quot;);

    //get请求过来的数据，在url地址栏上就已经经过编码了，所以我们取到的就是乱码，
    //tomcat收到了这批数据，getParameter 默认使用ISO-8859-1去解码
    //先让文字回到ISO-8859-1对应的字节数组 ， 然后再按utf-8组拼字符串
    username = new String(username.getBytes(&quot;ISO-8859-1&quot;) , &quot;UTF-8&quot;);
    System.out.println(&quot;userName=&quot;+username+&quot;==password=&quot;+password);


    //输出响应
    System.out.println(&quot;username==&quot;+username+&quot;  &quot;+&quot;password==&quot;+password);
    PrintWriter pw=response.getWriter();

    //构造ServletContext对象来存取登录次数，从而让登录成功页面的Servlet共享数据
    Object obj=getServletContext().getAttribute(&quot;count&quot;);
    int totalNumber=0;
    if(obj!=null) {
        totalNumber=(int)obj;
    }
    getServletContext().setAttribute(&quot;count&quot;, totalNumber+1);



    //html跳转
    if(&quot;admin&quot;.equals(username)&amp;&amp;&quot;123&quot;.equals(password)) {

        //设置状态码302可以重定位网页资源
        //response.setStatus(302);
        //response.setHeader(&quot;Location&quot;,&quot;login_success.html&quot;);
        response.sendRedirect(&quot;login_success.html&quot;);
        //request.getRequestDispatcher(&quot;login_success.html&quot;).forward(request, response);
    }else {

        //登录失败就直接在Servlet的页面输出响应，上面是跳转到别的html页面
        pw.write(&quot;login failed&quot;);
    }
}

protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
        }
}
</code></pre><blockquote>
<ol>
<li>地址上显示的是请求servlet的地址。  返回200 ok</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>请求次数只有一次， 因为是服务器内部帮客户端执行了后续的工作。 </li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>只能跳转自己项目的资源路径 。  </li>
</ol>
</blockquote>
<blockquote>
<ol start="4">
<li>效率上稍微高一点，因为只执行一次请求。 </li>
</ol>
</blockquote>
<blockquote>
<ol start="5">
<li>可以使用上一次的request对象。</li>
</ol>
</blockquote>
<p> <img src="/2019/03/15/Cookie+Session/1.png" alt></p>
<h3 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h3><p>[简单使用：服务器添加Cookie返回给客户端]</p>
<pre><code>import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class CookieServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    //一行代码搞定中文乱码问题，然后才开始写数据
    response.setContentType(&quot;text/html;charset=UTF-8&quot;);

    //构造Cookie对象
    Cookie cookie=new Cookie(&quot;name&quot;,&quot;testvalue&quot;);
    //把cookie对象添加到response对象返回给客户端缓存起来
    response.addCookie(cookie);
}


protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
            }
}
</code></pre><blockquote>
<p>http的请求是无状态。 客户端与服务器在通讯的时候，是无状态的，其实就是客户端在第二次来访的时候，服务器根本就不知道这个客户端以前有没有来访问过。 为了更好的用户体验，更好的交互 [自动登录]，其实从公司层面讲，就是为了更好的收集用户习惯[大数据];服务器可以通过给定客户端一个Cookie，缓存在客户端那里就可以记录客户端访问本服务器的历史</p>
</blockquote>
<blockquote>
<p>饼干. 其实是一份小数据， 是服务器给客户端，并且存储在客户端上的一份小数据</p>
</blockquote>
<blockquote>
<p>应用场景：自动登录、浏览记录、购物车</p>
</blockquote>
<blockquote>
<p>客户端收到的信息里面，响应头中多了一个字段 Set-Cookie</p>
</blockquote>
<p> <img src="/2019/03/15/Cookie+Session/2.png" alt></p>
<p>[<strong>简单使用：服务器端获取客户端请求携带的Cookie</strong>]</p>
<pre><code>import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class CookieServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    //一行代码搞定中文乱码问题，然后才开始写数据
    response.setContentType(&quot;text/html;charset=UTF-8&quot;);

    Cookie cookie=new Cookie(&quot;name2&quot;,&quot;1001&quot;);
    response.addCookie(cookie);


    Cookie[] cookies=request.getCookies();
    if(cookies!=null) {

        for(Cookie c:cookies) {

            String cookieName=c.getName();
            String cookieValue=c.getValue();
            System.out.println(&quot;cookieNmae== &quot;+cookieName);
            System.out.println(&quot;cookieValue== &quot;+cookieValue);
        }
    }
}


protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
        }

}
</code></pre><blockquote>
<p>Cookie[] cookies=request.getCookies();</p>
</blockquote>
<p>[<strong>Cookie常用API</strong>]</p>
<pre><code>import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class CookieServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    //一行代码搞定中文乱码问题，然后才开始写数据
    response.setContentType(&quot;text/html;charset=UTF-8&quot;);

    Cookie cookie=new Cookie(&quot;name2&quot;,&quot;1001&quot;);

    //关闭浏览器后，cookie就没有了。 ---&gt; 针对没有设置cookie的有效期。
            //    expiry： 有效 以秒计算。
            //正值 ： 表示 在这个数字过后，cookie将会失效。
            //负值： 关闭浏览器，那么cookie就失效， 默认值是 -1
            cookie.setMaxAge(60 * 60 * 24 * 7);

            //赋值新的值
            //cookie.setValue(newValue);

            //用于指定只有请求了指定的域名，才会带上该cookie
            cookie.setDomain(&quot;.itheima.com&quot;);

            //只有访问该域名下的cookieDemo的这个路径地址才会带cookie
            cookie.setPath(&quot;/CookieDemo&quot;);

            response.addCookie(cookie);

    //获取Cookie
    Cookie[] cookies=request.getCookies();
    if(cookies!=null) {

        for(Cookie c:cookies) {

            String cookieName=c.getName();
            String cookieValue=c.getValue();
            System.out.println(&quot;cookieNmae== &quot;+cookieName);
            System.out.println(&quot;cookieValue== &quot;+cookieValue);
        }
    }
}


protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
        }
}
</code></pre><p>[<strong>Cookie显示客户端上一次访问服务器的时间</strong>]</p>
<blockquote>
<ol>
<li>判断账号是否正确</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>如果正确，则获取cookie。 但是得到的cookie是一个数组， 我们要从数组里面找到我们想要的对象。</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>如果找到的对象为空，表明是第一次登录。那么要添加cookie</li>
</ol>
</blockquote>
<blockquote>
<ol start="4">
<li>如果找到的对象不为空， 表明不是第一次登录。 </li>
</ol>
</blockquote>
<p> <img src="/2019/03/15/Cookie+Session/4.png" alt></p>
<p> <img src="/2019/03/15/Cookie+Session/5.gif" alt></p>
<p>time_login.html</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h2&gt;欢迎登陆&lt;/h2&gt;

&lt;form action=&quot;TimeServlet&quot;&gt;
账号&lt;input type=&quot;text&quot; name=&quot;username&quot;/&gt; &lt;br &gt;
密码&lt;input type=&quot;text&quot; name=&quot;password&quot;/&gt; &lt;br &gt;
&lt;input type=&quot;submit&quot; value=&quot;登陆&quot;/&gt; &lt;br &gt;
&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>CookieUtil.java</p>
<pre><code>import javax.servlet.http.Cookie;

public class CookieUtil {


public static Cookie findCookie(Cookie[] cookies,String cookieName) {

    if(cookies!=null) {
        for(Cookie cookie:cookies) {
            if(cookieName.equals(cookie.getName())) {
                return cookie;
            }
        }
    }
    return null;
    }
}
</code></pre><p>TimeServlet.java</p>
<pre><code>import java.io.IOException;
import java.util.Date;
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class TimeServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    response.setContentType(&quot;text/html;charset=UTF-8&quot;);

    String userName=request.getParameter(&quot;username&quot;);
    String password=request.getParameter(&quot;password&quot;);

    if(&quot;admin&quot;.equals(userName) &amp;&amp; &quot;123&quot;.equals(password)){
        //获取cookie last-name --- &gt;
        Cookie [] cookies = request.getCookies();

        //从数组里面找出我们想要的cookie
        Cookie cookie = CookieUtil.findCookie(cookies, &quot;last&quot;);

        //是第一次登录，没有cookie
        if(cookie == null){

            Cookie c = new Cookie(&quot;last&quot;, System.currentTimeMillis()+&quot;&quot;);
            c.setMaxAge(60*60); //一个小时
            response.addCookie(c);

            response.getWriter().write(&quot;欢迎您, &quot;+userName);

        }else{
            //1. 去以前的cookie第二次登录，有cookie
            long lastVisitTime = Long.parseLong(cookie.getValue());

            //2. 输出到界面，
            response.getWriter().write(&quot;欢迎您, &quot;+userName +&quot;,上次来访时间是：&quot;+new Date(lastVisitTime));


            //3. 重置登录的时间
            cookie.setValue(System.currentTimeMillis()+&quot;&quot;);
            response.addCookie(cookie);
        }
    }else{
        response.getWriter().write(&quot;登陆失败 &quot;);
    }
}


protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
        }

}



protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
    }

}
</code></pre><p> <img src="/2019/03/15/Cookie+Session/5.gif" alt></p>
<p>[Cookie来实现浏览记录]</p>
<p>  <img src="/2019/03/15/Cookie+Session/6.png" alt></p>
<p>点击html—&gt;Servlet来response Cookie—&gt;跳转到详情html</p>
<p>ProductInfoServlet.java: 来response cookie来给客户端</p>
<pre><code>import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class ProductInfoServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    //接收页面跳转时的id参数值
    String id=request.getParameter(&quot;id&quot;);

    //Cookie查询
    Cookie[] cookies=request.getCookies();
    Cookie cookie=CookieUtil.findCookie(cookies, &quot;history&quot;);

    //第一次浏览
    if(cookie==null) {

        Cookie c=new Cookie(&quot;history&quot;,id);
        response.addCookie(c);

        //存完cookie再跳转
        response.sendRedirect(&quot;product_info.htm&quot;);
    }else {

        //第二次访问服务器，服务器就拿第一次存给客户端的Cookie，并拼接新的Cookie值
        String ids=cookie.getValue();
        cookie.setValue(id+&quot;#&quot;+ids);
        response.addCookie(cookie);

        //跳转
        response.sendRedirect(&quot;product_info.htm&quot;);

    }
}


protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
            }
}
</code></pre><blockquote>
<p>一个Cookie对象就可以实现浏览记录，值使用#来拼接每个页面的id值：3#2#1，其它符号作为分隔符也可以</p>
</blockquote>
<p>[JSP的格式==html + java==翻译成一个Servlet的类]</p>
<pre><code>//定义全局变量

&lt;%! int a = 99; %&gt;

//定义局部变量
&lt;% int b = 999; %&gt;

//在jsp页面上，显示 a 和 b的值，
&lt;%=a %&gt; 
&lt;%=b %&gt;
</code></pre><p>[JSP显示浏览记录:导包快捷键：Alt+/]</p>
<pre><code>&lt;%@page import=&quot;org.apache.jasper.tagplugins.jstl.core.ForEach&quot;%&gt;
&lt;%@page import=&quot;com.itheima.util.CookieUtil&quot;%&gt;
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;
......
......

&lt;ul style=&quot;list-style: none;&quot;&gt;
            &lt;%
            Cookie[] cookie = request.getCookies();
            Cookie cook =     CookieUtil.findCookie(cookie, &quot;history&quot;);
            if(cook == null){
                %&gt;
                &lt;h2&gt;您还没浏览任何商品&lt;/h2&gt;

                &lt;%
            }else{
            String [] id =    cook.getValue().split(&quot;#&quot;);
            for(String i : id){
                %&gt;
                &lt;li style=&quot;width: 150px;height: 216;float: left;margin: 0 8px 0 0;padding: 0 18px 15px;text-align: center;&quot;&gt;&lt;img src=&quot;products/1/cs1000&lt;%=i %&gt;.jpg&quot; width=&quot;130px&quot; height=&quot;130px&quot; /&gt;&lt;/li&gt;
        &lt;%            
            }
            }

            %&gt;
            &lt;/ul&gt;
    ......
    ......
</code></pre><p>[JSP清除浏览记录]<br>本质是写一个同key的cookie来代替原先的cookie，并setMaxAge(0)删除掉，再重定向回当前html</p>
<pre><code>&lt;h2&gt;&lt;a href=&quot;ClearHistoryServlet&quot;&gt;清除浏览记录&lt;/a&gt;&lt;/h2&gt;


import javax.servlet.ServletException;
import javax.servlet.http.Cookie;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class ClearHistoryServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    Cookie cookie=new Cookie(&quot;history&quot;,&quot;&quot;);
    cookie.setMaxAge(0);
    //cookie.setPath(&quot;/CookieDemo02&quot;);
    response.addCookie(cookie);

    response.sendRedirect(&quot;product_list.jsp&quot;);
}


protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    doGet(request, response);
        }
    }
</code></pre><p>[Cookie总结]</p>
<blockquote>
<p> 服务器给客户端发送过来的一小份数据，并且存放在客户端上。</p>
</blockquote>
<blockquote>
<p> 获取cookie， 添加cookie</p>
</blockquote>
<pre><code>request.getCookie();

response.addCookie();
</code></pre><blockquote>
<p> Cookie分类</p>
</blockquote>
<pre><code>会话Cookie
    默认情况下，关闭了浏览器，那么cookie就会消失。

持久Cookie

    在一定时间内，都有效，并且会保存在客户端上。 

    cookie.setMaxAge(0); //设置立即删除

    cookie.setMaxAge(100); //100 秒
</code></pre><blockquote>
<p>Cookie的安全问题。</p>
</blockquote>
<pre><code>由于Cookie会保存在客户端上，所以有安全隐患问题。
还有一个问题， Cookie的大小与个数有限制,浏览器只支持每个Web服务器的20个Cookie,总共300个。 
为了解决这个问题 ---&gt; Session来解决需求.
</code></pre><p>[Session]</p>
<blockquote>
<p>会话 ， Session是基于Cookie的一种会话机制。 Cookie是服务器返回一小份数据给客户端，并且存放在客户端上。 Session是，数据存放在服务器端。</p>
</blockquote>
<blockquote>
<p>创建: 如果有在servlet里面调用了 request.getSession()就会创建Session对象</p>
</blockquote>
<blockquote>
<p>销毁：session 是存放在服务器的内存中的一份数据。 当然可以持久化. Redis . 即使关了浏览器，session也不会销毁。</p>
</blockquote>
<pre><code>1. 关闭服务器
2. session会话时间过期。 有效期过了，默认有效期： 30分钟。
</code></pre><p>[Session常用API]</p>
<pre><code>//得到会话ID
String id = session.getId();

//存值
session.setAttribute(name, value);

//取值
session.getAttribute(name);

//移除值
session.removeAttribute(name);
</code></pre><p>[Session实现简单购物车]</p>
<p>  <img src="/2019/03/15/Cookie+Session/7.png" alt></p>
<p>product_list.jsp</p>
<pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;a href=&quot;CarServlet?id=0&quot;&gt;&lt;h3&gt;Iphone7&lt;/h3&gt;&lt;/a&gt;
&lt;a href=&quot;CarServlet?id=1&quot;&gt;&lt;h3&gt;Iphone6&lt;/h3&gt;&lt;/a&gt;
&lt;a href=&quot;CarServlet?id=2&quot;&gt;&lt;h3&gt;Iphone5&lt;/h3&gt;&lt;/a&gt;
&lt;a href=&quot;CarServlet?id=3&quot;&gt;&lt;h3&gt;Iphone4&lt;/h3&gt;&lt;/a&gt;
&lt;a href=&quot;CarServlet?id=4&quot;&gt;&lt;h3&gt;Iphone3&lt;/h3&gt;&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>CartServlet.java</p>
<pre><code>import java.io.IOException;
import java.util.LinkedHashMap;
import java.util.Map;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class CarServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    response.setContentType(&quot;text/html;charset=UTF-8&quot;);

    //获取jsp超链接传过来的参数id的值
    int id=Integer.parseInt(request.getParameter(&quot;id&quot;));
    String[] names= {&quot;Iphone7&quot;,&quot;Iphone6&quot;,&quot;Iphone5&quot;,&quot;Iphone4&quot;,&quot;Iphone3&quot;};//模拟数据库数据
    String name=names[id];

    //从Session里面取map的key的值
    Map&lt;String,Integer&gt; map=(Map&lt;String,Integer&gt;)request.getSession().getAttribute(&quot;cart&quot;);
    if(map==null) {
        map = new LinkedHashMap&lt;String , Integer&gt;();
        request.getSession().setAttribute(&quot;cart&quot;, map);
    }
    // 判断购物车里面有没有该商品
    if(map.containsKey(name)){
        //在原来的值基础上  + 1 
        map.put(name, map.get(name) + 1 );
    }else{
        //没有购买过该商品，当前数量为1 。
        map.put(name, 1);
    }

    //4. 输出界面。（跳转:很神奇，java里面加html，html在write方法里面竟然可以跳转）
    response.getWriter().write(&quot;&lt;a href=&apos;product_list.jsp&apos;&gt;&lt;h3&gt;继续购物&lt;/h3&gt;&lt;/a&gt;&lt;br&gt;&quot;);
    response.getWriter().write(&quot;&lt;a href=&apos;cart.jsp&apos;&gt;&lt;h3&gt;去购物车结算&lt;/h3&gt;&lt;/a&gt;&quot;);

}

protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // TODO Auto-generated method stub
    doGet(request, response);
        }
}
</code></pre><p>cart.jsp(购物车的具体页面)</p>
<pre><code>&lt;%@page import=&quot;java.util.Map&quot;%&gt;
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h2&gt; 您的购物车商品如下&lt;/h2&gt;

//获取到map,map的key是商品名称，value是数量；Session--&gt;从cart取map--&gt;从map取value

&lt;%
 Map&lt;String,Integer&gt; map=(Map&lt;String,Integer&gt;)session.getAttribute(&quot;cart&quot;);

if(map!=null){

    for(String key:map.keySet()){

        int value=map.get(key);
        //key是名称，value是数量
        %&gt; 

        &lt;h3&gt;商品名称：  &lt;%=key %&gt;  数量： &lt;%=value %&gt;&lt;/h3&gt;
        &lt;%
        }
}

%&gt;

&lt;a href=&quot;ClearCartServlet&quot;&gt;&lt;h2&gt;清空购物车&lt;/h2&gt;&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>ClearCartServlet.java(清除购物车)</p>
<pre><code>import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

public class ClearCartServlet extends HttpServlet {

protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

    HttpSession session = request.getSession();

    //移除整个Session的所有数据
    session.invalidate();

    //移除Session某个key的数据
    session.removeAttribute(&quot;cart&quot;);

    //回到购物车页面
    response.sendRedirect(&quot;cart.jsp&quot;);
}

protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    // TODO Auto-generated method stub
    doGet(request, response);
    }

}
</code></pre><p>##总结：</p>
<p>【最重要】<br>Cookie和Session对象都是在服务器程序构造的，上面的例子都是服务器接收了html(或jsp)页面的数据，<br>然后构造Cookie或者Session对象，如果是Cookie，我们就通过response这个便车返回给客户端<br>如果是session，就不用返回，下次再访问服务器的时候，我们在服务器端做一次检查就可以了</p>
<ul>
<li>请求转发和重定向（面试经常问。）</li>
</ul>
<ul>
<li><p>Cookie</p>
<p>  服务器给客户端发送一小份数据， 存放在客户端上。</p>
<p>  基本用法：</p>
<pre><code>添加cookie

获取cookie。
</code></pre><p>  演练例子：</p>
<pre><code>1. 获取上一次访问时间

2. 获取商品浏览记录。
</code></pre></li>
<li><p>什么时候有cookie</p>
<p>  response.addCookie(new Cookie())</p>
</li>
<li><p>Cookie 分类</p>
<pre><code>会话Cookie

    关闭浏览器，就失效

持久cookie

    存放在客户端上。 在指定的期限内有效。 

    setMaxAge();
</code></pre></li>
</ul>
<ul>
<li><p>Session</p>
<pre><code>也是基于cookie的一种会话技术，  数据存放存放在服务器端

会在cookie里面添加一个字段 JSESSIONID . 是tomcat服务器生成。 

setAttribute 存数据

getAttribute 取数据

removeAttribute  移除数据

getSessionId();  获取会话id

invalidate() 强制让会话失效。
</code></pre></li>
<li><p>创建和销毁</p>
<p>  ，调用request.getSesion创建 </p>
<p>   服务器关闭 ， 会话超时（30分）</p>
</li>
</ul>
<p>setAttribute 存放的值， 在浏览器关闭后，还有没有。  有！，就算客户端把电脑砸了也还有。</p>
<p>  <img src="/2019/03/15/Cookie+Session/8.png" alt></p>
<p>  <img src="/2019/03/15/Cookie+Session/9.png" alt></p>
<p>  <img src="/2019/03/15/Cookie+Session/10.png" alt></p>
<p>  <img src="/2019/03/15/Cookie+Session/11.png" alt></p>
<p>  <img src="/2019/03/15/Cookie+Session/12.png" alt></p>
<p>  <img src="/2019/03/15/Cookie+Session/13.png" alt></p>
<p>  <img src="/2019/03/15/Cookie+Session/14.png" alt></p>
<p>  <img src="/2019/03/15/Cookie+Session/15.png" alt></p>
<p>  <img src="/2019/03/15/Cookie+Session/16.png" alt></p>
<p>  <img src="/2019/03/15/Cookie+Session/17.png" alt></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">QiuFeisheng</p>
              <p class="site-description motion-element" itemprop="description">Stay hungry</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">79</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">QiuFeisheng</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
